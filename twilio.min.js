(function e$$0(n,h,a){function d(b,c){if(!h[b]){if(!n[b]){var e="function"==typeof require&&require;if(!c&&e)return e(b,!0);if(g)return g(b,!0);e=Error("Cannot find module '"+b+"'");throw e.code="MODULE_NOT_FOUND",e;}e=h[b]={exports:{}};n[b][0].call(e.exports,function(a){var c=n[b][1][a];return d(c?c:a)},e,e.exports,e$$0,n,h,a)}return h[b].exports}for(var g="function"==typeof require&&require,e=0;e<a.length;e++)d(a[e]);return d})({1:[function(f,n,h){Twilio=function(a){var d=a||function(){};(function(a){for(var e in a)d[e]=
a[e]})(function(){var a=f("./twilio/util");a.getSDKVersion();var e="undefined"!=typeof e?e:function(){for(var a=location.protocol||"http:",b="//static.twilio.com/libs/twiliojs/1.0/",c=document.getElementsByTagName("script"),e=/(\w+:)?(\/\/.*)(twilio.min.js|twilio.js)/,l=0;l<c.length;l++){var d=c[l].src.match(e);if(d){a=d[1]||a;b=d[2];break}}return a+b}();a.setTwilioRoot(e);var b=e+"WebSocket.swf";"undefined"!==typeof window&&(window.WEB_SOCKET_SWF_LOCATION=b);var b=document.createElement("audio"),
c=!0;try{c=!(b.canPlayType&&(b.canPlayType("audio/mpeg").replace(/no/,"")||b.canPlayType('audio/ogg;codecs="vorbis"').replace(/no/,"")))}catch(k){}d.Sound=f("../vendor/sound/sound").Sound;d.Sound.initialize({swfLocation:e+"SoundMain.swf",forceFlash:c});var u=f("./twilio/device").Device,l=f("../vendor/mediastream/mediastream").MediaStream;u.__afterSetup(function(b,c){if(!f("./twilio/rtc").enabled()){var d=a.decode;l.initialize({objectEnc:l.AMF0,swfLocation:function(a,b){if(!a)return b;var c=b.match(/^(\w+):\/\/([^/]*)(.*)?/);
if(!c)return b;var e=c[1],l=c[2],c=c[3];if(!/twilio.com$/.test(l.split(":")[0]))return b;var t=d(a).iss;return t?e+"://"+t.toLowerCase()+"."+l+c:b}(b,e)+"MediaStreamMain.swf",loader:function(a,b){u.dialog.insert(a,b)}})}});b=f("./twilio");b.Sound=d.Sound;b.MediaStream=l;return b}());return d}("undefined"!==typeof Twilio?Twilio:null)},{"../vendor/mediastream/mediastream":35,"../vendor/sound/sound":36,"./twilio":2,"./twilio/device":4,"./twilio/rtc":14,"./twilio/util":21}],2:[function(f,n,h){h.Device=
f("./twilio/device").Device;h.EventStream=f("./twilio/eventstream").EventStream;h.PStream=f("./twilio/pstream").PStream;h.Connection=f("./twilio/connection").Connection;var a=f("./twilio/util");h.require=function(d){switch(d){case "twilio/rtc":return"undefined"!==typeof console&&("function"===typeof console.error?console.error("Twilio.require() is a private function and will be removed!"):"function"===typeof console.warn?console.warn("Twilio.require() is a private function and will be removed!"):
"function"===typeof console.log&&console.log("Twilio.require() is a private function and will be removed!")),{enabled:function(){var a=h.Device;return a.getMediaEngine()===a.getMediaEngine.WEBRTC}};default:throw new a.Exception("Twilio.require() is a private function and will be removed!");}}},{"./twilio/connection":3,"./twilio/device":4,"./twilio/eventstream":6,"./twilio/pstream":13,"./twilio/util":21}],3:[function(f,n,h){function a(c,l,t){function g(){}if(!(this instanceof a))return new a(c,l,t);
e.monitorEventEmitter("Twilio.Connection",this);this.device=c;this.message=l||{};t=t||{};c={logPrefix:"[Connection]",mediaStreamFactory:k.PeerConnection,offerSdp:null,debug:!1,encrypt:!1,audioConstraints:c.options.audioConstraints};for(var f in c)f in t||(t[f]=c[f]);this.options=t;this.parameters={};this._status=this.options.offerSdp?"pending":"closed";this.sendHangup=!0;b.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;this.log.warnings=this.options.warnings;this._onHangup=
this._onCancel=g;this._onAnswer=function(a){"undefined"!==typeof a.callsid&&(v.parameters.CallSid=a.callsid,v.mediaStream.callSid=a.callsid)};this.mediaStream=new this.options.mediaStreamFactory(this.options.encrypt,this.device);var v=this;this.mediaStream.onerror=function(a){!0===a.disconnect&&v.disconnect(a.info&&a.info.message);var b={code:a.info.code,message:a.info.message||"Error with mediastream",info:a.info,connection:v};v.log("Received an error from MediaStream:",a);v.emit("error",b)};this.mediaStream.onopen=
function(){"open"!==v._status&&("connecting"===v._status?(v._status="open",v.mediaStream.attachAudio(),v.mediaStream.play("output"),v.emit("accept",v)):v.mediaStream.close())};this.mediaStream.onclose=function(){v._status="closed";v.device.sounds.disconnect()&&v.device.soundcache.play("disconnect");v.emit("disconnect",v)};this.pstream=this.device.stream;this._onCancel=function(a){v.parameters.CallSid==a.callsid&&(v.ignore(),v.pstream.removeListener("cancel",v._onCancel))};this.pstream&&this.pstream.addListener("cancel",
this._onCancel);this.on("error",function(){v.pstream&&"disconnected"===v.pstream.status&&d(v)});this.on("disconnect",function(){d(v)});return this}function d(a){function b(){a.pstream.removeListener("answer",a._onAnswer);a.pstream.removeListener("cancel",a._onCancel);a.pstream.removeListener("hangup",a._onHangup)}b();setTimeout(b,0)}n=f("events").EventEmitter;var g=f("util"),e=f("./util"),b=f("./log"),c=f("./util").Exception,k=f("./rtc");g.inherits(a,n);a.toString=function(){return"[Twilio.Connection class]"};
a.prototype.toString=function(){return"[Twilio.Connection instance]"};a.prototype.sendDigits=function(a){if(a.match(/[^0-9*#w]/))throw new c("Illegal character passed into sendDigits");for(var b=[],e=0;e<a.length;e++){var d="w"!=a[e]?"dtmf"+a[e]:"";"dtmf*"==d&&(d="dtmfs");"dtmf#"==d&&(d="dtmfh");b.push([d,200,20])}this.device.soundcache.playseq(b);var g=this.mediaStream.getOrCreateDTMFSender();if(g){if(g.canInsertDTMF){var k=function(){var a=r.shift();a.length&&g.insertDTMF(a,160,70);r.length&&setTimeout(k,
500)};this.log("Sending digits using RTCDTMFSender");var r=a.split("w");r.length&&k();return}this.log("RTCDTMFSender cannot insert DTMF")}this.log("Sending digits over PStream");null!=this.pstream&&"disconnected"!=this.pstream.status?(a={dtmf:a,callsid:this.parameters.CallSid},this.pstream.publish("dtmf",a)):(a={error:{}},this.emit("error",{code:a.error.code||31E3,message:a.error.message||"Could not send DTMF: Signaling channel is disconnected",connection:this}))};a.prototype.status=function(){return this._status};
a.prototype.mute=function(a){0===arguments.length&&this.log.deprecated(".mute() is deprecated. Please use .mute(true) or .mute(false) to mute or unmute a call instead.");if("function"==typeof a)return this.addListener("mute",a);var b=this.isMuted(),c=this,e=function(){var a=c.isMuted();b!=a&&c.emit("mute",a,c)};0==a?this.mediaStream.attachAudio(e):this.mediaStream.detachAudio(e)};a.prototype.isMuted=function(){return!this.mediaStream.isAudioAttached()};a.prototype.unmute=function(){this.log.deprecated(".unmute() is deprecated. Please use .mute(false) to unmute a call instead.");
this.mute(!1)};a.prototype.accept=function(a){if("function"==typeof a)return this.addListener("accept",a);a=a||this.options.audioConstraints;var b=this;this._status="connecting";this.mediaStream.openHelper(function(a,c){if("connecting"!=b._status)d(b),b.mediaStream.close();else if(a)b._die(a,c);else{var g=[],k;for(k in b.message)g.push(encodeURIComponent(k)+"="+encodeURIComponent(b.message[k]));g=g.join("&");b.parameters.CallSid?b.mediaStream.answerIncomingCall.call(b.mediaStream,b.parameters.CallSid,
b.options.offerSdp):(b.outboundConnectionId=e.generateConnectionUUID(),b.mediaStream.makeOutgoingCall.call(b.mediaStream,g,b.outboundConnectionId),b.pstream.once("answer",b._onAnswer));b._onHangup=function(a){if(a.callsid&&(b.parameters.CallSid||b.outboundConnectionId)){if(a.callsid!=b.parameters.CallSid&&a.callsid!=b.outboundConnectionId)return}else if(a.callsid)return;b.log("Received HANGUP from gateway");a.error&&(a={code:a.error.code||31E3,message:a.error.message||"Error sent from gateway in HANGUP",
connection:b},b.log("Received an error from the gateway:",a),b.emit("error",a));b.sendHangup=!1;b.disconnect();d(b)};b.pstream.addListener("hangup",b._onHangup)}},a)};a.prototype.reject=function(a){if("function"==typeof a)return this.addListener("reject",a);"pending"==this._status&&(this.pstream.publish("reject",{callsid:this.parameters.CallSid}),this.emit("reject"))};a.prototype.ignore=function(a){if("function"==typeof a)return this.addListener("cancel",a);"pending"==this._status&&(this._status=
"closed",this.emit("cancel"))};a.prototype.cancel=function(a){this.log.deprecated(".cancel() is deprecated. Please use .ignore() instead.");this.ignore(a)};a.prototype.disconnect=function(a){if("function"==typeof a)return this.addListener("disconnect",a);a="string"===typeof a?a:null;if("open"==this._status||"connecting"==this._status){this.log("Disconnecting...");if(null!=this.pstream&&"disconnected"!=this.pstream.status&&this.sendHangup){var b=this.parameters.CallSid||this.outboundConnectionId;b&&
(b={callsid:b},a&&(b.message=a),this.pstream.publish("hangup",b))}d(this);this.mediaStream.close()}};a.prototype.error=function(a){if("function"==typeof a)return this.addListener("error",a)};a.prototype._die=function(a,b){this.emit("error",{message:a,code:b})};h.Connection=a},{"./log":8,"./rtc":14,"./util":21,events:27,util:31}],4:[function(f,n,h){function a(d,g){if(!(this instanceof a))return new a(d,g);b.monitorEventEmitter("Twilio.Device",this);if(!d)throw new b.Exception("Capability token is not valid or missing.");
var p={};for(i in g)p[i]=g[i];var x={logPrefix:"[Device]",host:"chunder.twilio.com",chunderw:"chunderw-gll.twilio.com",soundCacheFactory:u,soundFactory:l,connectionFactory:t,pStreamFactory:C,presenceFactory:y,noRegister:!1,encrypt:!1,simplePermissionDialog:!1,rtc:!0,debug:!1,closeProtection:!1,secureSignaling:!0,warnings:!0,audioConstraints:!0,chrome3940Workaround:!1};g=g||{};for(var q in x)q in g||(g[q]=x[q]);this.options=g;this.token=d;this._status="offline";this.connections=[];this.sounds=new k({incoming:!0,
outgoing:!0,disconnect:!0});this.options.rtc||c.enabled(!1);if(!c.enabled())return console.warn("Warning: Twilio Client will discontinue support for Flash in twilio.js 1.3."),new v(d,p);this.soundcache=this.options.soundCacheFactory();p="undefined"===typeof document?{}:document.createElement("audio");canPlayMp3=!1;try{canPlayMp3=!(!p.canPlayType||!p.canPlayType("audio/mpeg").replace(/no/,""))}catch(m){}canPlayVorbis=!1;try{canPlayVorbis=!(!p.canPlayType||!p.canPlayType('audio/ogg;codecs="vorbis"').replace(/no/,
""))}catch(z){}p="mp3";canPlayVorbis&&!canPlayMp3&&(p="ogg");var p={incoming:"sounds/incoming."+p,outgoing:"sounds/outgoing."+p,disconnect:"sounds/disconnect."+p,dtmf1:"sounds/dtmf-1."+p,dtmf2:"sounds/dtmf-2."+p,dtmf3:"sounds/dtmf-3."+p,dtmf4:"sounds/dtmf-4."+p,dtmf5:"sounds/dtmf-5."+p,dtmf6:"sounds/dtmf-6."+p,dtmf7:"sounds/dtmf-7."+p,dtmf8:"sounds/dtmf-8."+p,dtmf9:"sounds/dtmf-9."+p,dtmf0:"sounds/dtmf-0."+p,dtmfs:"sounds/dtmf-star."+p,dtmfh:"sounds/dtmf-hash."+p},x=b.getTwilioRoot(),A;for(A in p)q=
this.options.soundFactory(),q.load(x+p[A]),this.soundcache.add(A,q);this.soundcache.envelope("incoming",{release:2E3});e.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;var r=this;this.addListener("incoming",function(a){a.once("accept",function(){r.soundcache.stop("incoming")});a.once("cancel",function(){r.soundcache.stop("incoming")});a.once("error",function(){r.soundcache.stop("incoming")});a.once("reject",function(){r.soundcache.stop("incoming")});r.sounds.incoming()&&
r.soundcache.play("incoming",0,1E3)});this.mediaPresence={audio:!this.options.noRegister};this.register(this.token);var f=this.options.closeProtection;f&&(A=function(a){if("busy"==r._status){var m=1==f?"A call is currently in-progress. Leaving or reloading this page will end the call.":f;return(a||window.event).returnValue=m}},"undefined"!==typeof window&&(window.addEventListener?window.addEventListener("beforeunload",A):window.attachEvent&&window.attachEvent("onbeforeunload",A)));A=function(){r.disconnectAll()};
"undefined"!==typeof window&&(window.addEventListener?window.addEventListener("unload",A):window.attachEvent&&window.attachEvent("onunload",A));this.on("error",function(){});return this}function d(a,b,c){var e={encrypt:a.options.encrypt,debug:a.options.debug,warnings:a.options.warnings};c=c||{};for(var q in e)q in c||(c[q]=e[q]);var m=a.options.connectionFactory(a,b,c);m.once("accept",function(){a._status="busy";a.emit("connect",m)});m.addListener("error",function(b){a.emit("error",b);"pending"==
m.status()&&"connecting"==m.status()&&a._removeConnection(m)});m.once("cancel",function(){a.log("Canceled: "+m.parameters.CallSid);a._removeConnection(m);a.emit("cancel",m)});m.once("disconnect",function(){"busy"==a._status&&(a._status="ready");a.emit("disconnect",m);a._removeConnection(m)});m.once("reject",function(){a.log("Rejected: "+m.parameters.CallSid);a._removeConnection(m)});return m}n=f("events").EventEmitter;var g=f("util"),e=f("./log"),b=f("./util"),c=f("./rtc"),k=f("./options").Options,
u=f("./soundcache").SoundCache,l=f("../../vendor/sound/sound").Sound,t=f("./connection").Connection,C=f("./pstream").PStream,y=f("./presence").Presence,v=f("./olddevice").Device,r=f("./eventstream").EventStream,x=f("../../vendor/mediastream/mediastream").MediaStream;g.inherits(a,n);b.mixinGetMediaEngine(a.prototype);a.toString=function(){return"[Twilio.Device class]"};a.prototype.toString=function(){return"[Twilio.Device instance]"};a.prototype.register=function(a){this.stream&&"disconnected"!=this.stream.status?
this.stream.setToken(a):this._setupStream();this._setupEventStream(a)};a.prototype.registerPresence=function(){this.token&&(b.objectize(this.token).scope["client:incoming"]&&(this.mediaPresence.audio=!0,this.eventStream||this._setupEventStream(this.token)),this._sendPresence())};a.prototype.unregisterPresence=function(){this.mediaPresence.audio=!1;this._sendPresence();this._disconnectEventStream()};a.prototype.presence=function(a){console.warn("Warning: Twilio Client will discontinue support for Presence in twilio.js 1.3.");
"client:incoming"in b.objectize(this.token).scope&&(this.presenceClient.handlers.push(a),this.token&&1==this.presenceClient.handlers.length&&this._setupEventStream(this.token))};a.prototype.showSettings=function(b){console.warn("Warning: Twilio Client will discontinue support for Flash in twilio.js 1.3. As a result, Device.showSettings will be removed.");a.dialog.show(b||function(){});x.showSettings();a.dialog.screen.style.width="200%"};a.prototype.connect=function(a,b){if("function"==typeof a)return this.addListener("connect",
a);a=a||{};b=b||this.options.audioConstraints;var c=d(this,a);this.connections.push(c);if(this.sounds.outgoing()){var e=this;c.accept(function(){e.soundcache.play("outgoing")})}c.accept(b);return c};a.prototype.disconnectAll=function(){for(var a=[].concat(this.connections),b=0;b<a.length;b++)a[b].disconnect();0<this.connections.length&&this.log("Connections left pending: "+this.connections.length)};a.prototype.destroy=function(){this.stream&&(this.stream.destroy(),this.stream=null);this._disconnectEventStream();
this.swf&&this.swf.disconnect&&this.swf.disconnect()};a.prototype.disconnect=function(a){this.addListener("disconnect",a)};a.prototype.incoming=function(a){this.addListener("incoming",a)};a.prototype.offline=function(a){this.addListener("offline",a)};a.prototype.ready=function(a){this.addListener("ready",a)};a.prototype.error=function(a){this.addListener("error",a)};a.prototype.status=function(){return this._status};a.prototype.activeConnection=function(){return this.connections[0]};a.prototype._sendPresence=
function(){this.stream.register(this.mediaPresence);this.mediaPresence.audio?this._startRegistrationTimer():this._stopRegistrationTimer()};a.prototype._startRegistrationTimer=function(){clearTimeout(this.regTimer);var a=this;this.regTimer=setTimeout(function(){a._sendPresence()},3E4)};a.prototype._stopRegistrationTimer=function(){clearTimeout(this.regTimer)};a.prototype._setupStream=function(){var a=this;this.log("Setting up PStream");this.stream=this.options.pStreamFactory(this.token,{chunder:this.options.host,
chunderw:this.options.chunderw,debug:this.options.debug,secureSignaling:this.options.secureSignaling});this.stream.addListener("connected",function(){a._sendPresence()});this.stream.addListener("ready",function(){a.log("Stream is ready");"offline"==a._status&&(a._status="ready");a.emit("ready",a)});this.stream.addListener("offline",function(){a.log("Stream is offline");a._status="offline";a.emit("offline",a)});this.stream.addListener("error",function(b){var c=b.error;c&&(b.callsid&&(c.connection=
a._findConnection(b.callsid)),a.log("Received error: ",c),a.emit("error",c))});this.stream.addListener("invite",function(b){if("busy"==a._status)a.log("Device busy; ignoring incoming invite");else if(b.callsid&&b.sdp){var c=d(a,{},{offerSdp:b.sdp});c.parameters=b.parameters||{};c.parameters.CallSid=c.parameters.CallSid||b.callsid;a.connections.push(c);a.emit("incoming",c)}else a.emit("error",{message:"Malformed invite from gateway"})})};a.prototype._setupEventStream=function(a){this.options.eventStreamFactory=
this.options.eventStreamFactory||r;this.options.eventsScheme=this.options.eventsScheme||"wss";this.options.eventsHost=this.options.eventsHost||"matrix.twilio.com";var c=[],e=null;"client:incoming"in b.objectize(a).scope&&(c.push("publishPresence"),this.presenceClient&&0<this.presenceClient.handlers.length&&c.push("presenceEvents"),e=function(a,m,c,e){e=e||[];for(var d=[],l=0;l<e.length;l++)d.push("feature="+e[l]);e=["AccessToken="+a].concat(d);return[m+"://"+c,"2012-02-09",b.objectize(a).iss,b.objectize(a).scope["client:incoming"].params.clientName].join("/")+
"?"+e.join("&")}(a,this.options.eventsScheme,this.options.eventsHost,c));var d=this;e&&this.mediaPresence.audio?this.eventStream?(this.eventStream.options.url=e,this.eventStream.reconnect(a)):(this.log("Registering to eventStream with url: "+e),this.eventStream=new this.options.eventStreamFactory(a,{logPrefix:"[Matrix]",debug:this.options.debug,url:e}),this.eventStream.addListener("error",function(a){d.log("Received error: ",a);d.emit("error",a)}),a=b.objectize(a).scope["client:incoming"].params.clientName,
this.presenceClient=this.options.presenceFactory(a,this,this.eventStream,{autoStart:!0})):this._disconnectEventStream()};a.prototype._disconnectEventStream=function(){this.eventStream&&(this.eventStream.destroy(),this.presenceClient&&this.presenceClient.detach(this.eventStream),this.eventStream=null);this.log("Destroyed eventstream.")};a.prototype._removeConnection=function(a){for(var b=this.connections.length-1;0<=b;b--)a==this.connections[b]&&this.connections.splice(b,1)};a.prototype._findConnection=
function(a){for(var b=0;b<this.connections.length;b++){var c=this.connections[b];if(c.parameters.CallSid==a||c.outboundConnectionId==a)return c}};a=function(c){var e=[],d=[],l=function(a){if(c.instance)return a();d.push(a)},q=function(a){a=(a.code?a.code+": ":"")+a.message;if(c.instance){for(var m=0,e=c.instance.listeners("error"),d=0;d<e.length;d++)e[d]!==q&&m++;if(1<m)return;c.instance.log(a)}throw new b.Exception(a);},m={instance:null,setup:function(m,b){if(c.instance)c.instance.log("Found existing Device; using new token but ignoring options"),
c.instance.token=m,c.instance.register(m);else{c.instance=new a(m,b);c.error(q);c.sounds=c.instance.sounds;for(var l=0;l<d.length;l++)d[l]();d=[]}for(l=0;l<e.length;l++)e[l](m,b);e=[];return c},connect:function(a,m){if("function"==typeof a)l(function(){c.instance.addListener("connect",a)});else{if(!c.instance)throw new b.Exception("Run Twilio.Device.setup()");if(0<c.instance.connections.length)c.instance.emit("error",{message:"A connection is currently active"});else return c.instance.connect(a,m)}},
disconnectAll:function(){l(function(){c.instance.disconnectAll()});return c},disconnect:function(a){l(function(){c.instance.addListener("disconnect",a)});return c},status:function(){return c.instance._status},ready:function(a){l(function(){c.instance.addListener("ready",a)});return c},error:function(a){l(function(){a!=q&&c.instance.removeListener("error",q);c.instance.addListener("error",a)});return c},presence:function(a){l(function(){c.instance.presence(a)});return c},offline:function(a){l(function(){c.instance.addListener("offline",
a)});return c},incoming:function(a){l(function(){c.instance.addListener("incoming",a)});return c},destroy:function(){c.instance&&c.instance.destroy();return c},cancel:function(a){l(function(){c.instance.addListener("cancel",a)});return c},showPermissionsDialog:function(){if(!c.instance)throw new b.Exception("Run Twilio.Device.setup()");c.instance.showSettings()},activeConnection:function(){return c.instance?c.instance.activeConnection():null},__afterSetup:function(a){e.push(a)}},g;for(g in m)c[g]=
m[g];c.getMediaEngine=function(){return c.instance?c.instance.getMediaEngine():b.getMediaEngine()};c.getMediaEngine.FLASH=b.getMediaEngine.FLASH;c.getMediaEngine.WEBRTC=b.getMediaEngine.WEBRTC;return c}(a);a.dialog=v.dialog;h.Device=a},{"../../vendor/mediastream/mediastream":35,"../../vendor/sound/sound":36,"./connection":3,"./eventstream":6,"./log":8,"./olddevice":10,"./options":11,"./presence":12,"./pstream":13,"./rtc":14,"./soundcache":18,"./util":21,events:27,util:31}],5:[function(f,n,h){function a(){if(!(this instanceof
a))return new a;if("undefined"!==typeof document){var d=document.createElement("div"),g=document.createElement("div"),e=document.createElement("button");d.style.position="fixed";d.style.zIndex="99999";d.style.top="0";d.style.left="0";d.style.width="1px";d.style.height="1px";d.style.overflow="hidden";d.style.visibility="hidden";g.style.margin="10% auto 0";g.style.width="215px";g.style.borderRadius="8px";g.style.backgroundColor="#f8f8f8";g.style.border="8px solid rgb(160, 160, 160)";var b=this,c=function(){b.hide();
b.closeCb&&b.closeCb.call()};e.appendChild(document.createTextNode("Close"));"undefined"!==typeof window&&(window.addEventListener?e.addEventListener("click",c,!1):e.attachEvent("onclick",c));d.appendChild(g);g.appendChild(e);this.screen=d;this.dialog=g;this.close=e;this.container=null;this.inserted=!1;this.embed=function(){};document.body?(document.body.appendChild(d),b.inserted=!0):(b=this,g=function(){document.body.appendChild(d);b.inserted=!0;b.embed()},"undefined"!==typeof window&&(window.addEventListener?
window.addEventListener("load",g,!1):window.attachEvent("onload",g)))}}a.prototype.insert=function(a,g){if(this.container){if(this.container==a)return;this.dialog.removeChild(this.container)}this.container=a;this.dialog.insertBefore(a,this.close);this.embed=g||this.embed();this.inserted&&this.embed()};a.prototype.show=function(a){if("undefined"!==typeof window&&"undefined"!==typeof document){this.close.style.display=a?"":"none";this.closeCb=a;this.screen.style.width="100%";this.screen.style.height=
"auto";this.screen.style.visibility="visible";a=this.dialog.style.width.replace("px","")|0;var g=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;this.dialog.style.marginLeft=(((window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)-a)/2|0)+"px";this.dialog.style.marginTop=(.1*g|0)+"px"}};a.prototype.hide=function(){this.screen.style.width="1px";this.screen.style.height="1px";this.screen.style.visibility="hidden"};h.Dialog=a},{}],6:[function(f,
n,h){function a(a,b){return function(){var c=Array.prototype.slice.call(arguments,0);if("function"==typeof c[0])return a.addListener(b,c[0]);c.unshift(b);return a.emit.apply(a,c)}}function d(a,b){var c;c="string"!=typeof a?"":a.trim?a.trim():a.replace(/^\s+|\s+$/g,"");return 0==c.length?[]:c.split("\n")}function g(e,d){if(!(this instanceof g))return new g(e,d);c.monitorEventEmitter("Twilio.EventStream",this);var u={logPrefix:"[EventStream]",scheme:"wss",host:"stream.twilio.com",reconnect:!0,url:null,
flashTimeout:5E3,filters:{},debug:!1};d=d||{};for(var f in u)f in d||(d[f]=u[f]);this.options=d;this.token=e||"";this.handlers={};this.status="offline";b.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;this.heartbeat=new k({interval:15});this._connect();u="incoming ready offline sms call twiml error".split(" ");for(f=0;f<u.length;f++)this[u[f]]=a(this,u[f]);var v=this;this.addListener("publish",function(a){v.emit("twiml",a)});this.on("error",function(){});return this}JSON=
"undefined"!==typeof JSON?JSON:f("../../vendor/json2");n=f("events").EventEmitter;var e=f("util"),b=f("./log"),c=f("./util"),k=f("./heartbeat").Heartbeat,u=f("../../vendor/web-socket-js/web_socket").WebSocket;e.inherits(g,n);g.initializingFlash=!1;g.initializeFlash=function(a){g.initializingFlash||(g.initializingFlash=!0,u&&u.__initialize&&(WEB_SOCKET_SWF_LOCATION=a.options.swfLocation,u.__initialize(),a.log("Waiting "+a.options.flashTimeout+"ms for flash to initialize"),setTimeout(function(){u.__flash||
a.log("WebSocket did not initialize")},a.options.flashTimeout)))};g.toString=function(){return"[Twilio.EventStream class]"};g.prototype.toString=function(){return"[Twilio.EventStream instance]"};g.prototype.destroy=function(){this.socket.close();this.options.reconnect=!1;return this};g.prototype.publish=function(a,b){try{this.socket.send(JSON.stringify({"rt.message":"publish","rt.subchannel":b,"rt.payload":a}))}catch(c){this.log("Error while publishing to eventstream. Reconnecting socket."),this.socket&&
this.socket.close(),this._tryReconnect()}};g.prototype._cleanupSocket=function(a){if(a){var b=function(){};a.onopen=function(){a.close()};a.onmessage=b;a.onerror=b;a.onclose=b;2>a.readyState&&a.close()}};g.prototype._connect=function(a){var b=this,c=this._extractUrl(),e=++a||1;if(c){var g=this.socket;this.log("Attempting to connect to "+c+"...");try{this.socket=new u(c)}catch(k){this.log("Connection to "+c+" failed: "+(k.message||""));return}this.socket.onopen=function(){b.log("Socket opened... sending ready signal");
b._cleanupSocket(g);b.socket.send(JSON.stringify({"rt.message":"listen","rt.token":b.token}))};this.socket.onerror=function(a){a.data?b.emit("error",{message:a.data.message||"",code:a.data.code||""}):b.log("Received message event:",a)};this.socket.onmessage=function(a){b.heartbeat.beat();if("\n"!=a.data){a=d(a.data);for(var l=0;l<a.length;l++){var g=JSON.parse(a[l]);if("ready"==g["rt.message"])"ready"!=b.status&&(b.status="ready",b.emit("ready",b));else{var k=g["rt.message"]||g.EventType;if("error"==
k){var u=g.message||"";b.log("Connection to "+c+" failed: "+u);/^4/.test(g.code)?b.options.reconnect=!1:5>e?(u=50*Math.pow(2,e),u=30+Math.round(Math.random()*u),setTimeout(function(){b.socket&&b.socket.close();b._connect(e)},u)):b.emit("error",{message:"Connection to Twilio failed: "+u,code:g.code||""})}"incoming"!=k&&b.emit("incoming",g);b.emit(k,g)}}}};this.socket.onclose=function(){b._cleanupSocket(g);"offline"!=b.status&&(b.log("Gone offline"),b.status="offline",b.emit("offline",b))};this.heartbeat.onsleep=
function(){b.log("Connection heartbeat timed out.");b.socket&&b.socket.close();b._tryReconnect(5E3)}}else this.log("Nothing to do")};g.prototype.reconnect=function(a){this.socket&&(0==this.socket.readyState?(socket=this.socket,socket.onopen=function(){socket.close()}):this.socket.close());this.token=a;this.options.reconnect=!0;this._tryReconnect()};g.prototype._extractUrl=function(){if(this.options.url)return this.options.url;var a=c.objectize(this.token).scope;if(!("stream:subscribe"in a))return null;
var a=a["stream:subscribe"],a=a.params&&a.params.path?a.params.path:"/",b=this.options.filters;b.AccessToken=this.token;return this.options.scheme+"://"+this.options.host+a+"?"+c.urlencode(b,!0)};g.prototype._tryReconnect=function(a){(new Date).getTime();if(this.options.reconnect&&null!=this._extractUrl()){a=a||5E3;this._connect();var b=function(b){return function(){b._tryReconnect(2*a)}}(this),c=function(e){return function(){switch(e.socket.readyState){case 0:setTimeout(c,1E3);break;case 1:break;
default:setTimeout(b,a)}}}(this);setTimeout(c,5E3)}};g=function(a){var b=[],c=function(c){if(a.instance)return c();b.push(c)},e={instance:null,status:"offline",setup:function(c,e){a.instance=new a(c,e);for(var d=0;d<b.length;d++)b[d]();a.ready(function(){a.status="ready"});a.offline(function(){a.status="offline"});return a},incoming:function(b){c(function(){a.instance.incoming(b)});return a},ready:function(b){c(function(){a.instance.ready(b)});return a},offline:function(b){c(function(){a.instance.offline(b)});
return a},sms:function(b){c(function(){a.instance.sms(b)});return a},call:function(b){c(function(){a.instance.call(b)});return a},twiml:function(b){c(function(){a.instance.twiml(b)});return a},error:function(b){c(function(){a.instance.error(b)});return a}},d;for(d in e)a[d]=e[d];return a}(g);h.EventStream=g},{"../../vendor/json2":34,"../../vendor/web-socket-js/web_socket":38,"./heartbeat":7,"./log":8,"./util":21,events:27,util:31}],7:[function(f,n,h){function a(d){if(!(this instanceof a))return new a(d);
d=d||{};var g=function(){},g={interval:10,now:function(){return(new Date).getTime()},repeat:function(a,c){return setInterval(a,c)},stop:function(a,c){return clearInterval(a,c)},onsleep:g,onwakeup:g},e;for(e in g)e in d||(d[e]=g[e]);this.interval=d.interval;this.lastbeat=0;this.pintvl=null;this.onsleep=d.onsleep;this.onwakeup=d.onwakeup;this.repeat=d.repeat;this.stop=d.stop;this.now=d.now}a.toString=function(){return"[Twilio.Heartbeat class]"};a.prototype.toString=function(){return"[Twilio.Heartbeat instance]"};
a.prototype.beat=function(){this.lastbeat=this.now();if(this.sleeping()){if(this.onwakeup)this.onwakeup();var a=this;this.pintvl=this.repeat.call(null,function(){a.check()},1E3*this.interval)}};a.prototype.check=function(){var a=this.now()-this.lastbeat;if(!this.sleeping()&&a>=1E3*this.interval){if(this.onsleep)this.onsleep();this.stop.call(null,this.pintvl);this.pintvl=null}};a.prototype.sleeping=function(){return null==this.pintvl};h.Heartbeat=a},{}],8:[function(f,n,h){h.mixinLog=function(a,d){function g(){if(g.enabled)for(var a=
g.prefix?g.prefix+" ":"",b=0;b<arguments.length;b++){var c=arguments[b];g.handler("string"==typeof c?a+c:c)}}g.enabled=!0;g.prefix=d||"";g.defaultHandler=function(a){"undefined"!==typeof console&&console.log(a)};g.handler=g.defaultHandler;g.warnings=!0;g.defaultWarnHandler=function(a){"undefined"!==typeof console&&("function"===typeof console.warn?console.warn(a):"function"===typeof console.log&&console.log(a))};g.warnHandler=g.defaultWarnHandler;g.deprecated=function(){if(g.warnings)for(var a=0;a<
arguments.length;a++)g.warnHandler(arguments[a])};a.log=g}},{}],9:[function(f,n,h){function a(b,d,t){if(!(this instanceof a))return new a(b,d,t);g.monitorEventEmitter("Twilio.Connection",this);this.device=b;this.message=d||{};t=t||{};b={logPrefix:"[Connection]",bridgeToken:null,mediaStreamFactory:c.enabled()?c.PeerConnection:k,chunder:"chunder.prod.twilio.com",chunderw:"chunderw.prod.twilio.com",debug:!1,encrypt:!1,token:null};for(var f in b)f in t||(t[f]=b[f]);this.options=t;this.parameters={};this._status=
this.options.bridgeToken?"pending":"closed";e.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;this.log.warnings=this.options.warnings;this.mediaStream=new this.options.mediaStreamFactory(this.options.encrypt,this.options[c.enabled()?"chunderw":"chunder"],this.device.options.simplePermissionDialog);var h=this;this.mediaStream.onerror=function(a){var b={code:a.info.code,message:a.info.message,info:a.info};h.log("Received an error from MediaStream:",a);h.emit("error",b)};this.mediaStream.onopen=
function(){h._status="open";h.mediaStream.attachAudio();h.mediaStream.play("output");h.emit("accept",h)};this.mediaStream.onclose=function(){h._status="closed";h.device.sounds.disconnect()&&h.device.soundcache.play("disconnect");h.emit("disconnect",h)};this.mediaStream.onCallSid=function(a){h.parameters.CallSid=a};this.on("error",function(){});return this}n=f("events").EventEmitter;var d=f("util"),g=f("./util"),e=f("./log"),b=f("./util").Exception,c=f("./rtc"),k=f("../../vendor/mediastream/mediastream").MediaStream;
d.inherits(a,n);a.toString=function(){return"[Twilio.Connection class]"};a.prototype.toString=function(){return"[Twilio.Connection instance]"};a.prototype.sendDigits=function(a){if(a.match(/[^0-9*#w]/))throw new b("Illegal character passed into sendDigits");this.mediaStream.exec("sendDTMF",a);for(var c=[],e=0;e<a.length;e++){var d="w"!=a[e]?"dtmf"+a[e]:"";"dtmf*"==d&&(d="dtmfs");"dtmf#"==d&&(d="dtmfh");c.push([d,200,20])}this.device.soundcache.playseq(c)};a.prototype.status=function(){return this._status};
a.prototype.mute=function(a){0===arguments.length&&this.log.deprecated(".mute() is deprecated. Please use .mute(true) or .mute(false) to mute or unmute a call instead.");if("function"==typeof a)return this.addListener("mute",a);var b=this.isMuted(),c=this,e=function(){var a=c.isMuted();b!=a&&c.emit("mute",a,c)};0==a?this.mediaStream.attachAudio(e):this.mediaStream.detachAudio(e)};a.prototype.isMuted=function(){return!this.mediaStream.isAudioAttached()};a.prototype.unmute=function(){this.log.deprecated(".unmute() is deprecated. Please use .mute(false) to unmute a call instead.");
this.mute(!1)};a.prototype.accept=function(b){if("function"==typeof b)return this.addListener("accept",b);var c=this;this._status="pending";var e=c.device.constructor;this.mediaStream.openHelper(function(a,b){if(a)c._die(a,b);else{var e=[],d;for(d in c.message)e.push(encodeURIComponent(d)+"="+encodeURIComponent(c.message[d]));e=[c.mediaStream.uri(),c.options.token,c.options.bridgeToken,e.join("&")].concat(c.options.acceptParams);e.push(g.getSDKVersion());c.mediaStream.open.apply(c.mediaStream,e)}},
this.device.options.simplePermissionDialog,a.NO_MIC_LEVEL||0,{showDialog:function(){e.dialog.show()},closeDialog:function(a){e.dialog.hide();c.device.options.simplePermissionDialog=a;a||(c._die("Access to microphone has been denied"),c.disconnect())}},function(a){c.device.showSettings(a)})};a.prototype.reject=function(a){if("function"==typeof a)return this.addListener("reject",a);this.device.stream.publish({Response:"reject",CallSid:this.parameters.CallSid},this.options.rejectChannel);this.emit("reject")};
a.prototype.ignore=function(a){if("function"==typeof a)return this.addListener("cancel",a);this._status="closed";this.emit("cancel")};a.prototype.cancel=function(a){this.log.deprecated(".cancel() is deprecated. Please use .ignore() instead.");this.ignore(a)};a.prototype.disconnect=function(a){if("function"==typeof a)return this.addListener("disconnect",a);"open"==this._status&&(this.log("Disconnecting..."),this.mediaStream.close())};a.prototype.error=function(a){if("function"==typeof a)return this.addListener("error",
a)};a.prototype._die=function(a,b){this.emit("error",{message:a,code:b})};h.Connection=a},{"../../vendor/mediastream/mediastream":35,"./log":8,"./rtc":14,"./util":21,events:27,util:31}],10:[function(f,n,h){function a(d,k){if(!(this instanceof a))return new a(d,k);e.monitorEventEmitter("Twilio.Device",this);if(!d)throw new e.Exception("Capability token is not valid or missing.");var f={logPrefix:"[Device]",host:"chunder.twilio.com",chunderw:"chunderw.twilio.com",soundCacheFactory:u,soundFactory:l,
connectionFactory:t,eventStreamFactory:y,presenceFactory:C,eventsScheme:"wss",eventsHost:"matrix.twilio.com",noRegister:!1,encrypt:!1,simplePermissionDialog:!1,rtc:!0,debug:!1,closeProtection:!1,warnings:!0};k=k||{};for(var h in f)h in k||(k[h]=f[h]);this.options=k;this.token=d;this._status="offline";this.connections=[];this.sounds=new c({incoming:!0,outgoing:!0,disconnect:!0});this.options.rtc||b.enabled(!1);this.soundcache=this.options.soundCacheFactory();f="undefined"===typeof document?{}:document.createElement("audio");
canPlayMp3=!1;try{canPlayMp3=!(!f.canPlayType||!f.canPlayType("audio/mpeg").replace(/no/,""))}catch(p){}canPlayVorbis=!1;try{canPlayVorbis=!(!f.canPlayType||!f.canPlayType('audio/ogg;codecs="vorbis"').replace(/no/,""))}catch(v){}f="mp3";canPlayVorbis&&!canPlayMp3&&(f="ogg");f={incoming:"sounds/incoming."+f,outgoing:"sounds/outgoing."+f,disconnect:"sounds/disconnect."+f,dtmf1:"sounds/dtmf-1."+f,dtmf2:"sounds/dtmf-2."+f,dtmf3:"sounds/dtmf-3."+f,dtmf4:"sounds/dtmf-4."+f,dtmf5:"sounds/dtmf-5."+f,dtmf6:"sounds/dtmf-6."+
f,dtmf7:"sounds/dtmf-7."+f,dtmf8:"sounds/dtmf-8."+f,dtmf9:"sounds/dtmf-9."+f,dtmf0:"sounds/dtmf-0."+f,dtmfs:"sounds/dtmf-star."+f,dtmfh:"sounds/dtmf-hash."+f};h=e.getTwilioRoot();for(var q in f){var m=this.options.soundFactory();m.load(h+f[q]);this.soundcache.add(q,m)}this.soundcache.envelope("incoming",{release:2E3});g.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;var z=this;this.addListener("incoming",function(a){a.addListener("accept",function(){z.soundcache.stop("incoming")});
a.addListener("cancel",function(){z.soundcache.stop("incoming")});a.addListener("error",function(){z.soundcache.stop("incoming")});z.sounds.incoming()&&z.soundcache.play("incoming",0,1E3)});this.register(this.token);var A=this.options.closeProtection;A&&(q=function(a){if("busy"==z._status){var b=1==A?"A call is currently in-progress. Leaving or reloading this page will end the call.":A;return(a||window.event).returnValue=b}},addEventListener?addEventListener("beforeunload",q):attachEvent&&attachEvent("onbeforeunload",
q));q=function(){z.disconnectAll()};"undefined"!==typeof window&&(window.addEventListener?window.addEventListener("unload",q):window.attachEvent&&window.attachEvent("onunload",q));this.on("error",function(){});return this}JSON="undefined"!==typeof JSON?JSON:f("../../vendor/json2");n=f("events").EventEmitter;var d=f("util"),g=f("./log"),e=f("./util"),b=f("./rtc"),c=f("./options").Options,k=f("./dialog").Dialog,u=f("./soundcache").SoundCache,l=f("../../vendor/sound/sound").Sound,t=f("./oldconnection").Connection;
f("./pstream");var C=f("./presence").Presence;f("./olddevice");var y=f("./eventstream").EventStream,v=f("../../vendor/mediastream/mediastream").MediaStream;d.inherits(a,n);e.mixinGetMediaEngine(a.prototype);a.toString=function(){return"[Twilio.Device class]"};a.prototype.toString=function(){return"[Twilio.Device instance]"};a.prototype.makeConnection=function(a,b,c,d,g){var k={acceptParams:[JSON.stringify(e.getSystemInfo()),e.objectize(a.token).iss],chunder:a.options.host,chunderw:a.options.chunderw,
encrypt:a.options.encrypt,debug:a.options.debug,warnings:a.options.warnings};g=g||{};for(var q in k)q in g||(g[q]=k[q]);"bridge"==c?(g.bridgeToken=b,g.token=null):"jwt"==c?(g.bridgeToken=null,g.token=b):this.log("Unknown token type: "+c);var m=a.options.connectionFactory(a,d,g);m.addListener("accept",function(){a._status="busy";a.emit("connect",m)});m.addListener("error",function(b){a.emit("error",b);if("pending"==m.status()){b=[].concat(a.connections);for(var c=0;c<b.length;c++)m==b[c]&&a.connections.splice(c,
1)}});m.addListener("cancel",function(){a.log("Canceled: "+m.parameters.CallSid);for(var b=[].concat(a.connections),c=0;c<b.length;c++)m==b[c]&&a.connections.splice(c,1);a.emit("cancel",m)});m.addListener("disconnect",function(){"busy"==a._status&&(a._status="ready");a.emit("disconnect",m);for(var b=[].concat(a.connections),c=0;c<b.length;c++)m==b[c]&&a.connections.splice(c,1)});return m};a.prototype.register=function(a){var b=[],c=null;"client:incoming"in e.objectize(a).scope&&(b.push("incomingCalls"),
b.push("publishPresence"),this.presenceClient&&0<this.presenceClient.handlers.length&&b.push("presenceEvents"),c=function(a,b,c,m){m=m||[];for(var d=[],g=0;g<m.length;g++)d.push("feature="+m[g]);m=["AccessToken="+a].concat(d);return[b+"://"+c,"2012-02-09",e.objectize(a).iss,e.objectize(a).scope["client:incoming"].params.clientName].join("/")+"?"+m.join("&")}(a,this.options.eventsScheme,this.options.eventsHost,b));var d=this;!c||this.options.noRegister?(this.stream&&(this.stream.destroy(),this.presenceClient&&
this.presenceClient.detach(this.stream),this.stream=null),this.log("Unable to receive incoming calls"),"offline"==d._status&&(d._status="ready"),setTimeout(function(){d.emit("ready",d)},0)):this.stream?(this.stream.options.url=c,this.stream.reconnect(a)):(this.log("Registering to stream with url: "+c),this.stream=this.options.eventStreamFactory(a,{logPrefix:"[Matrix]",debug:this.options.debug,url:c}),this.stream.addListener("ready",function(){d.log("Stream is ready");"offline"==d._status&&(d._status=
"ready");d.emit("ready",d)}),this.stream.addListener("offline",function(){d.log("Stream is offline");d._status="offline";d.emit("offline",d)}),this.stream.addListener("error",function(a){d.log("Received error: ",a);d.emit("error",a)}),this.stream.addListener("incoming",function(a){d.log("Message incoming...",a);switch(a.Request){case "invite":if("busy"==d._status){d.log("Device busy; ignoring incoming invite");break}if(!a.Token||!a.CallSid){d.emit("error",{message:"Malformed invite"});break}var b=
a.Parameters||{};a=d.makeConnection(d,a.Token,"bridge",{},{rejectChannel:a.RejectChannel});a.parameters=b;d.connections.push(a);d.emit("incoming",a);break;case "cancel":for(var b=[].concat(d.connections),c=0;c<b.length;c++){var m=b[c];m.parameters.CallSid==a.CallSid&&"pending"==m.status()&&m.ignore()}}}),a=e.objectize(a).scope["client:incoming"].params.clientName,this.presenceClient=this.options.presenceFactory(a,this,this.stream,{autoStart:!0}))};a.prototype.presence=function(a){"client:incoming"in
e.objectize(this.token).scope&&(this.presenceClient.handlers.push(a),this.token&&1==this.presenceClient.handlers.length&&this.register(this.token))};a.prototype.showSettings=function(b){a.dialog.show(b||function(){});v.showSettings();a.dialog.screen.style.width="200%"};a.prototype.connect=function(a){if("function"==typeof a)return this.addListener("connect",a);a=a||{};a=this.makeConnection(this,this.token,"jwt",a);this.connections.push(a);if(this.sounds.outgoing()){var b=this;a.accept(function(){b.soundcache.play("outgoing")})}a.accept();
return a};a.prototype.disconnectAll=function(a){if("function"==typeof a)return this.addListener("disconnectAll",a);a=[].concat(this.connections);for(var b=0;b<a.length;b++)a[b].disconnect();0<this.connections.length&&this.log("Connections left pending: "+this.connections.length)};a.prototype.destroy=function(){this.stream.destroy();this.swf&&this.swf.disconnect&&this.swf.disconnect()};a.prototype.disconnect=function(a){this.addListener("disconnect",a)};a.prototype.incoming=function(a){this.addListener("incoming",
a)};a.prototype.offline=function(a){this.addListener("offline",a)};a.prototype.ready=function(a){this.addListener("ready",a)};a.prototype.error=function(a){this.addListener("error",a)};a.prototype.status=function(){return this._status};a.prototype.activeConnection=function(){return this.connections[0]};a.dialog=k();h.Device=a},{"../../vendor/json2":34,"../../vendor/mediastream/mediastream":35,"../../vendor/sound/sound":36,"./dialog":5,"./eventstream":6,"./log":8,"./oldconnection":9,"./olddevice":10,
"./options":11,"./presence":12,"./pstream":13,"./rtc":14,"./soundcache":18,"./util":21,events:27,util:31}],11:[function(f,n,h){f=function(){function a(g,e){if(!(this instanceof a))return new a(g);this.__dict__={};g=g||{};e=e||{};for(var b in g)this[b]=d(this.__dict__,b),this[b](g[b]);for(b in e)this[b](e[b])}function d(a,e){return function(b){return"undefined"==typeof b?a[e]:a[e]=b}}return a}();h.Options=f},{}],12:[function(f,n,h){var a=f("./util").Set,d=f("./util").bind,g=f("./options").Options,
e=f("./state"),b=function(a,b){return a+a*(2*Math.random()+-1)*b};f=function(){function c(b,f,h,v){if(!(this instanceof c))return new c(b,f,h,v);this.roster=new a;this.handlers=[];this.clientName=b;this.options=new g({autoStart:!1,interval:300,variation:.2,clearTimeout:function(a){return clearTimeout(a)},setTimeout:function(a,b){return setTimeout(a,b)}},v);this._boundPresence=d(u,this);this._boundRoster=d(l,this);h.addListener("offline",d(this.handleOffline,this));this.attach(h);this._boundHeartbeat=
d(k,this,h,{ttl:2*this.options.interval(),availability:"available",keepalive:!0});b=new e.StateM({stop:"start",start:"stop"},this);this.start=b.doStart;this.stop=b.doStop;this.options.autoStart()&&this.start()}function k(a,b){a.publish(b,"presence")}function u(a){this[a.Available?"addToRoster":"removeFromRoster"](a.From)}function l(a){for(var b=0;b<a.Roster.length;b++)this.addToRoster(a.Roster[b])}c.prototype.enterStart=function(a,c){c={tid:null};var e=this;(function r(){var a=b(e.options.interval(),
e.options.variation());c.tid=e.options.setTimeout()(function(){e._boundHeartbeat();r()},1E3*a)})();return c};c.prototype.enterStop=function(a,b){this.options.clearTimeout()(b.tid)};c.prototype.heartbeat=k;c.prototype.attach=function(a){a.addListener("presence",this._boundPresence);a.addListener("roster",this._boundRoster)};c.prototype.detach=function(a){a.removeListener("presence",this._boundPresence);a.removeListener("roster",this._boundRoster)};c.prototype.removeFromRoster=function(a){this.roster.del(a);
this.invoke(a,!1)};c.prototype.addToRoster=function(a){this.roster.put(a);this.invoke(a,!0)};c.prototype.handleOffline=function(){var a=d(this.removeFromRoster,this);this.roster.map(a)};c.prototype.handlePresence=u;c.prototype.handleRoster=l;c.prototype.invoke=function(a,b){if(a!==this.clientName)for(var c={from:a,available:b},e=0;e<this.handlers.length;e++)this.handlers[e](c)};return c}();h.Presence=f},{"./options":11,"./state":19,"./util":21}],13:[function(f,n,h){function a(d,u){if(!(this instanceof
a))return new a(d,u);e.monitorEventEmitter("Twilio.PStream",this);var l={logPrefix:"[PStream]",chunder:"chunder.twilio.com",chunderw:"chunderw-gll.twilio.com",secureSignaling:!0,transportFactory:c,debug:!1};u=u||{};for(var f in l)f in u||(u[f]=l[f]);this.options=u;this.token=d||"";this.status="disconnected";this.host=b.enabled()?this.options.chunderw:this.options.chunder;g.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;this.on("error",function(){});var h=this;this.addListener("ready",
function(){h.status="ready"});this.addListener("offline",function(){h.status="offline"});this.addListener("close",function(){h.destroy()});this.transport=this.options.transportFactory({host:this.host,debug:this.options.debug,secureSignaling:this.options.secureSignaling});this.transport.onopen=function(){h.status="connected";h.setToken(h.token)};this.transport.onclose=function(){"disconnected"!=h.status&&("offline"!=h.status&&h.emit("offline",h),h.status="disconnected")};this.transport.onerror=function(a){h.emit("error",
a)};this.transport.onmessage=function(a){a=e.splitObjects(a.data);for(var b=0;b<a.length;b++){var c=JSON.parse(a[b]);h.emit(c.type,c.payload||{})}};this.transport.open();return this}JSON="undefined"!==typeof JSON?JSON:f("../../vendor/json2");n=f("events").EventEmitter;var d=f("util"),g=f("./log"),e=f("./util"),b=f("./rtc");f("./heartbeat");var c=f("./wstransport").WSTransport;d.inherits(a,n);a.toString=function(){return"[Twilio.PStream class]"};a.prototype.toString=function(){return"[Twilio.PStream instance]"};
a.prototype.setToken=function(a){this.log("Setting token and publishing listen");this.token=a;a={token:a,browserinfo:e.getSystemInfo()};this.publish("listen",a)};a.prototype.register=function(a){this.publish("register",{media:a})};a.prototype.destroy=function(){this.log("Closing PStream");this.transport.close();return this};a.prototype.publish=function(a,b){var c=JSON.stringify({type:a,version:e.getSDKVersion(),payload:b});this.transport.send(c)};h.PStream=a},{"../../vendor/json2":34,"./heartbeat":7,
"./log":8,"./rtc":14,"./util":21,"./wstransport":22,events:27,util:31}],14:[function(f,n,h){var a=f("./peerconnection");n.exports={PeerConnection:f("./peerconnection"),enabled:function(d){"undefined"!==typeof d&&(a.enabled=d);return a.enabled}}},{"./peerconnection":16}],15:[function(f,n,h){function a(a,e){if("undefined"===typeof webkitRTCPeerConnection)return e(Error("This does not appear to be Chrome 38"));var b=new webkitRTCPeerConnection({iceServers:[]}),c=new webkitRTCPeerConnection({iceServers:[]});
b.addStream(a);b.createOffer(function(a){var d=new RTCSessionDescription(a);b.setLocalDescription(d,function(){c.setRemoteDescription(d,function(){c.createAnswer(function(a){var d=new RTCSessionDescription(a);c.setLocalDescription(d,function(){b.setRemoteDescription(d,function(){e(null,b)},e)},e)},e)},e)},e)},e)}var d=f("./stats");n.exports=function(g,e){function b(a,g){if(a)return c.close(),e(a);if(20===++k||0!==f)return c.close(),e(null,0!==f);if(!("audioInputLevel"in g))return setTimeout(function(){d(c,
b)},100);f+=g.audioInputLevel;setTimeout(function(){d(c,b)},100)}var c=null,k=0,f=0;a(g,function(a,g){if(a)return e(a);c=g;d(c,b)})}},{"./stats":17}],16:[function(f,n,h){function a(b,e){if(!(this instanceof a))return new a(b,e);var d=function(){};this.onclose=this.onerror=this.onopen=d;this.version=null;this.pstream=e.stream;this.stream=null;this.video="undefined"!==typeof document&&document.createElement("video");this.video.autoplay="autoplay";this.device=e;this.status="connecting";this._dtmfSender=
this.callSid=null;this._dtmfSenderUnsupported=!1;this._sampleStatistics=this._publishStatistics=null;this._statistics=[];this._nextTimeToPublish=Date.now();this._onAnswer=d;c.mixinLog(this,"[Twilio.PeerConnection]");this.log.enabled=this.device.options.debug;this.log.warnings=this.device.options.warnings;this.device.options.chrome3940Workaround||(r=!1);this._iceConnectionStateMachine=new C(y,"new");this._signalingStateMachine=new C(v,"stable");return this}function d(a){return{iceconnection:a.iceConnectionState,
icegathering:a.iceGatheringState,signaling:a.signalingState}}function g(a,b){b&&(a._statistics.push(b),a.startPublishingStatistics())}function e(a,b){var c=a?{timestamp:a.timestamp,packets:{recvlost:a.packetsLost,recvtot:a.packetsReceived,senttot:a.packetsSent},bytes:{recvtot:a.bytesReceived,senttot:a.bytesSent},jitter:a.jitter,rtt:a.rtt,audio:{inlvl:a.audioInputLevel,outlvl:a.audioOutputLevel}}:{};c.timestamp=c.timestamp||Math.floor(new Date/1E3);c.pc=b;return c}function b(a){"function"===typeof MediaStreamTrack.prototype.stop?
("function"===typeof a.getAudioTracks?a.getAudioTracks():a.audioTracks).forEach(function(a){a.stop()}):a.stop()}var c=f("../log"),k=f("../util"),u=f("./stats"),l=f("./issue3940"),t=f("stacktrace-js"),C=f("../statemachine"),y={"new":["checking","closed"],checking:["new","connected","failed","closed","completed"],connected:["new","disconnected","completed","closed"],completed:["new","disconnected","closed","completed"],failed:["new","disconnected","closed"],disconnected:["connected","completed","failed",
"closed"],closed:[]},v={stable:["have-local-offer","have-remote-offer","closed"],"have-local-offer":["stable","closed"],"have-remote-offer":["stable","closed"],closed:[]},r=function(){var a=k.detectBrowser();return a[0]===k.detectBrowser.CHROME&&36<=a[1]&&{audioConstraints:null,localStream:null}}();a.prototype.uri=function(){return this._uri};a.prototype.openHelper=function(c,e){function d(m){if(r)return f.log("Got MediaStream; starting monitor"),l(m,function(k,l){if(k)return f.log("Monitor failed; "+
k),f.log("Setting local MediaStream anyway"),f.stream=m,c();if(!l){f.log("Local MediaStream is bad! Requesting new MediaStream");r.audioConstraints=null;b(m);if(0<--q)return a.getUserMedia({audio:e},d,g);c("Error occurred while accessing microphone.",31201)}f.log("Local MediaStream appears good; saving");r.localStream=m;f.stream=m;c()});f.stream=m;c()}function g(a){r&&(r.audioConstraints=null);a.code==a.PERMISSION_DENIED?c("User denied access to microphone, or the web browser did not allow microphone access at this address.",
31208):c("Error occurred while accessing microphone.",31201)}var f=this;if(r&&(r.audioConstraints=r.audioConstraints||e,k.deepEqual(r.audioConstraints,e)||(console.warn("Due to a bug in Chrome 38, only the first set of audioConstraints will take effect."),f.log("Ignoring new audioConstraints: "+JSON.stringify(e)),f.log("Reusing existing audioConstraints: "+JSON.stringify(e))),r.localStream)){f.log("Reusing local MediaStream");f.stream=r.localStream;c();return}a.getUserMedia({audio:e},d,g);var q=10};
a.prototype._setupPeerConnection=function(){var b=a.protocol;b.create(this.log);b.pc.addStream(this.stream);var c=this;b.pc.onaddstream=function(a){"undefined"!==typeof c.video.srcObject?c.video.srcObject=a.stream:"undefined"!==typeof c.video.mozSrcObject?c.video.mozSrcObject=a.stream:"undefined"!==typeof c.video.src?c.video.src=(window.URL||window.webkitURL).createObjectURL(a.stream):c.log("Error attaching stream to element.");var k=e(null,d(b.pc)),l={};a.stream&&(l.active=a.stream.active,l.id=a.stream.id,
a="function"===typeof a.stream.getAudioTracks?a.stream.getAudioTracks():a.stream.audioTracks,l.tracks=a.map(function(a){return{enabled:a.enabled,id:a.id,kind:a.kind,label:a.label,muted:a.muted,readonly:a.readonly,readyState:a.readyState,remote:a.remote}}));k.pc.onaddstream=l;g(c,k)};return b};a.prototype._setupChannel=function(){var a=this,b=this.version.pc;a.version.pc.onopen=function(){a.status="open";a.onopen()};a.version.pc.onstatechange=function(b){a.version.pc&&"stable"==a.version.pc.readyState&&
(a.status="open",a.onopen())};a.version.pc.onsignalingstatechange=function(c){c=b.signalingState;a.log('signalingState is "'+c+'"');var k=e(null,d(b));g(a,k);try{a._signalingStateMachine.transition(c)}catch(q){k=e(null,d(b)),k.pc.invalidsignalingtransition=q.message,g(a,k)}a.version.pc&&"stable"==a.version.pc.signalingState&&(a.status="open",a.onopen())};b.onicecandidate=function(c){c=c.candidate||"end-of-candidates";var k=e(null,d(b));k.pc.oncandidate=c;g(a,k)};b.oniceconnectionstatechange=function(){var c=
b.iceConnectionState,k='iceConnectionState is "'+c+'"',q=e(null,d(b));g(a,q);try{a._iceConnectionStateMachine.transition(c)}catch(m){q=e(null,d(b)),q.pc.invalidiceconnectiontransition=m.message,g(a,q)}q=null;switch(c){case "disconnected":q="ICE liveness checks failed. May be having trouble connecting to Twilio.";case "failed":c="failed"===c;a.log(k+(c?"; disconnecting":""));a.onerror({info:{code:31003,message:q||"ICE negotiation with Twilio failed. Call will terminate."},disconnect:c});break;default:a.log(k)}};
if("disconnected"!=a.pstream.status){var c=function(k){if("closed"===a.status)a.pstream.removeListener("candidate",c);else if(k.callsid==a.callSid){var l=e(null,d(b));l.pc.addcandidate=k.candidate;g(a,l);a.version.processCandidate(k.candidate,k.label,function(){var c=e(null,d(b));c.pc.addcandidatesuccess=k.candidate;g(a,c)},function(c){var m=e(null,d(b));m.pc.addcandidatefailure={candidate:k.candidate};c&&c.message&&(m.pc.addcandidatefailure.error=c.message);g(a,m)})}};a.pstream.addListener("candidate",
c)}};a.prototype._initializeMediaStream=function(){if("open"==this.status)return!1;if("disconnected"==this.pstream.status)return this.onerror({info:{code:31E3,message:"Cannot establish connection. Client is disconnected"}}),this.close(),!1;this.version=this._setupPeerConnection();this._setupChannel();return!0};a.prototype.makeOutgoingCall=function(a,b){if(this._initializeMediaStream()){var c=this;this.callSid=b;var e=function(){},d=function(a){c.onerror({info:{code:31E3,message:"Error processing answer: "+
(a.message||a)}})};this._onAnswer=function(a){"closed"!=c.status&&c.version.processAnswer(a.sdp,e,d)};this.pstream.once("answer",this._onAnswer);this.version.createOffer({audio:!0},function(){"closed"!=c.status&&(c.pstream.publish("invite",{sdp:c.version.getSDP(),callsid:c.callSid,twilio:{accountsid:c.device.token?k.objectize(c.device.token).iss:null,params:a}}),c.startSamplingStatistics())},function(a){c.onerror({info:{code:31E3,message:"Error creating the offer: "+(a.message||a)}})})}};a.prototype.answerIncomingCall=
function(a,b){if(this._initializeMediaStream()){this.callSid=a;var c=this;this.version.processSDP(b,{audio:!0},function(){"closed"!=c.status&&(c.pstream.publish("answer",{callsid:a,sdp:c.version.getSDP()}),c.startSamplingStatistics())},function(a){c.onerror({info:{code:31E3,message:"Error creating the answer: "+(a.message||a)}})})}};a.prototype.close=function(){this.stopSamplingStatistics();if(this.version&&this.version.pc){var a;"closed"!==this.version.pc.signalingState?(a="client",this.version.pc.close()):
a="unknown";var c=e(null,d(this.version.pc));c.pc.whoclosed=a;try{c.pc.stacktraceonclose=t().map(function(a){return a.toString()}).join("\n")}catch(k){c.pc.stacktraceoncloseerror=k?k.message:null}c.pc.signalingtransitions=this._signalingStateMachine.transitions.map(function(a){return a.from});c.pc.iceconnectiontransitions=this._iceConnectionStateMachine.transitions.map(function(a){return a.from});g(this,c);this.version.pc=null}this.stream&&(r||b(this.stream),this.stream=null);this.pstream&&this.pstream.removeListener("answer",
this._onAnswer);this.video.src="";this.status="closed";this.onclose()};a.prototype.play=function(){};a.prototype.publish=function(){};a.prototype.attachAudio=function(a){this.stream&&(("function"===typeof this.stream.getAudioTracks?this.stream.getAudioTracks():this.stream.audioTracks)[0].enabled=!0);a&&"function"==typeof a&&a()};a.prototype.detachAudio=function(a){this.stream&&(("function"===typeof this.stream.getAudioTracks?this.stream.getAudioTracks():this.stream.audioTracks)[0].enabled=!1);a&&
"function"==typeof a&&a()};a.prototype.isAudioAttached=function(){return this.stream?("function"===typeof this.stream.getAudioTracks?this.stream.getAudioTracks():this.stream.audioTracks)[0].enabled:!1};a.prototype.startPublishingStatistics=function(){if(!this._publishStatistics){var a=this,b=Math.max(this._nextTimeToPublish-Date.now(),0);this._publishStatistics=setTimeout(function(){a._publishStatistics=null;var b=a.pstream,c=a.callSid;if(c&&"disconnected"!==b.status){var e=a._statistics.splice(0);
e.length&&b.publish("meta",{callsid:c,quality:e})}a._nextTimeToPublish+=1E4},b)}};a.prototype.stopSamplingStatistics=function(){clearInterval(this._sampleStatistics);this._sampleStatistics=null};a.prototype.startSamplingStatistics=function(){this.stopSamplingStatistics();var a=this;this._sampleStatistics=setInterval(function(){var b=d(a.version.pc);u(a.version.pc,function(c,d){c?a.stopSamplingStatistics():(d=e(d,b),g(a,d))})},1E3)};a.getUserMedia=function(a,b,c){"undefined"!=typeof navigator&&("function"==
typeof navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(a,b,c):"function"==typeof navigator.mozGetUserMedia?navigator.mozGetUserMedia(a,b,c):this.log("No getUserMedia() implementation available"))};a.prototype.getOrCreateDTMFSender=function(){if(this._dtmfSender)return this._dtmfSender;if(this._dtmfSenderUnsupported)return null;var a=this.version.pc;if(!a)return this.log("No RTCPeerConnection available to call createDTMFSender on"),null;if("function"!==typeof a.createDTMFSender)return this.log("RTCPeerConnection does not support createDTMFSender"),
this._dtmfSenderUnsupported=!0,null;for(var b=a.getLocalStreams(),c,e,d=0;d<b.length;d++)if(c=b[d],c="function"===typeof c.getAudioTracks?c.getAudioTracks():c.audioTracks,c.length){e=c[0];break}if(!e)return this.log("No local audio MediaStreamTrack available on the RTCPeerConnection to pass to createDTMFSender"),null;this.log("Creating RTCDTMFSender");return this._dtmfSender=a=a.createDTMFSender(e)};f=function(){"undefined"!=typeof window&&("function"==typeof window.webkitRTCPeerConnection?this.RTCPeerConnection=
webkitRTCPeerConnection:"function"==typeof window.mozRTCPeerConnection?(this.RTCPeerConnection=mozRTCPeerConnection,RTCSessionDescription=mozRTCSessionDescription,RTCIceCandidate=mozRTCIceCandidate):this.log("No RTCPeerConnection implementation available"))};f.prototype.create=function(a){this.log=a;this.pc=new this.RTCPeerConnection({iceServers:[]})};f.prototype.createModernConstraints=function(a){if("undefined"===typeof a)return null;var b={};"undefined"!==typeof webkitRTCPeerConnection?(b.mandatory=
{},"undefined"!==typeof a.audio&&(b.mandatory.OfferToReceiveAudio=a.audio),"undefined"!==typeof a.video&&(b.mandatory.OfferToReceiveVideo=a.video)):("undefined"!==typeof a.audio&&(b.offerToReceiveAudio=a.audio),"undefined"!==typeof a.video&&(b.offerToReceiveVideo=a.video));return b};f.prototype.createOffer=function(a,b,c){var e=this;this.pc.createOffer(function(a){e.pc&&e.pc.setLocalDescription(new RTCSessionDescription(a),b,c)},c,this.createModernConstraints(a))};f.prototype.createAnswer=function(a,
b,c){var e=this;this.pc.createAnswer(function(a){e.pc&&e.pc.setLocalDescription(new RTCSessionDescription(a),b,c)},c,this.createModernConstraints(a))};f.prototype.processSDP=function(a,b,c,e){var d=this;this.pc.setRemoteDescription(new RTCSessionDescription({sdp:a,type:"offer"}),function(){d.createAnswer(b,c,e)},e)};f.prototype.getSDP=function(){return this.pc.localDescription.sdp};f.prototype.processAnswer=function(a,b,c){this.pc&&this.pc.setRemoteDescription(new RTCSessionDescription({sdp:a,type:"answer"}),
b,c)};f.prototype.processCandidate=function(a,b,c,e){if(this.pc)return this.pc.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:0,candidate:a}),c,e)};f.test=function(){if("object"==typeof navigator){if(navigator.webkitGetUserMedia&&"function"==typeof window.webkitRTCPeerConnection)return!0;if(navigator.mozGetUserMedia&&"function"==typeof window.mozRTCPeerConnection){try{if("function"!==typeof(new window.mozRTCPeerConnection).getLocalStreams)return!1}catch(a){return!1}return!0}}};f=f.test()?new f:
null;a.protocol=f;a.enabled=!!a.protocol;n.exports=a},{"../log":8,"../statemachine":20,"../util":21,"./issue3940":15,"./stats":17,"stacktrace-js":32}],17:[function(f,n,h){function a(a,c){var g=[],k=[];a.result().forEach(function(a){var b=null;switch(a.type){case "googCandidatePair":a:{for(var b={},c={},l=a.names(),f=a.timestamp?Math.floor(a.timestamp/1E3):null,u=0;u<l.length;u++){var h=l[u],q=a.stat(h);switch(h){case "googActiveConnection":if("true"!==q){b=null;break a}break;case "googLocalAddress":b.localAddress=
q;break;case "googRemoteAddress":b.remoteAddress=q;break;case "googRtt":b.rtt=Number(q);break;case "":break;default:c[h]=q}}b.timestamp=f;b=e(b,c)}break;case "ssrc":b=d(a);break;default:k.push(a)}b&&g.push(b)});if(0===g.length||0===(g=b(g)).length)return c(null,{});var f=g.reduceRight(function(a,b){for(var c in b)a[c]=b[c];return a},{});c(null,f)}function d(a){var b={},c={},d=a.names(),g=a.timestamp?Math.floor(a.timestamp/1E3):null;d.forEach(function(e){var d=a.stat(e);switch(e){case "googCodecName":""!==
d&&(b.codecName=d);break;case "googJitterBufferMs":b.googJitterBufferMs=Number(d);break;case "googJitterReceived":e=Number(d);-1!==e&&(b.jitter=e);break;case "bytesReceived":case "bytesSent":case "packetsReceived":case "packetsSent":case "timestamp":case "audioInputLevel":case "audioOutputLevel":b[e]=Number(d);break;case "packetsLost":d=Number(d);-1!==d&&(b[e]=d);break;default:c[e]=d}});b.timestamp=g;return e(b,c)}function g(a,c){var d=[],g=[];a.forEach(function(a){var b=null;switch(a.type){case "inboundrtp":var c=
{},b={},k;for(k in a){var l=a[k];switch(k){case "mozRtt":c.rtt=l;break;case "timestamp":c[k]=Math.floor(l/1E3);break;case "jitter":c[k]=1E3*l;break;case "bytesReceived":case "packetsLost":case "packetsReceived":c[k]=l;break;default:b[k]=l}}b=e(c,b);break;case "outboundrtp":if(!1===a.isRemote){k={};b={};for(c in a)switch(l=a[c],c){case "timestamp":k[c]=Math.floor(l/1E3);case "bytesSent":case "packetsSent":k[c]=l;break;default:b[c]=l}b=e(k,b)}break;default:g.push(a)}b&&d.push(b)});if(0===d.length||
0===(d=b(d)).length)return c(null,{});var k=d.reduceRight(function(a,b){for(var c in b)a[c]=b[c];return a},{});c(null,k)}function e(a,b){var e=null;c(a)||(e=e||{},e.known=a);c(b)||(e=e||{},e.unknown=b);return e}function b(a){for(var b=[],c=0;c<a.length;c++){var e=a[c];e.known&&b.push(e.known)}return b}function c(a){if(!a)return!0;for(var b in a)return!1;return!0}function k(a,b){return function(){var c=Array.prototype.slice.call(arguments);c.push(b);return a.apply(null,c)}}n.exports=function(b,c){var e=
Error("WebRTC statistics are unsupported");b?"undefined"===typeof navigator||"function"!==typeof b.getStats?c(e):navigator.webkitGetUserMedia?b.getStats(k(a,c),c):navigator.mozGetUserMedia?b.getStats(null,k(g,c),c):c(e):c(Error("PeerConnection is null"))}},{}],18:[function(f,n,h){function a(a,e){return function(){var b=Array.prototype.slice(arguments);e.apply(a,b)}}function d(){if(!(this instanceof d))return new d;this.cache={}}d.prototype.add=function(a,e,b){b=b||{};if(!(b instanceof Object))throw new TypeError("Bad envelope type; expected Object");
e instanceof Array||(e=[e]);this.cache[a]={starttime:null,sounds:e,envelope:b}};d.prototype.play=function(a,e,b){e=e||0;b=b||1;if(a in this.cache){a=this.cache[a];for(var c=0;c<a.sounds.length;c++)a.sounds[c].play(e,b);a.starttime=(new Date).getTime()}};d.prototype.stop=function(a){if(a in this.cache){var e=this.cache[a];a=e.envelope.release||0;var b=function(){for(var a=0;a<e.sounds.length;a++)e.sounds[a].stop()},c=(new Date).getTime(),c=Math.max(0,a-(c-e.starttime));0==a?b():setTimeout(b,c)}};d.prototype.envelope=
function(a,e){if(a in this.cache){var b=this.cache[a],c;for(c in e)b.envelope[c]=e[c]}};d.prototype.playseq=function(){var d=null,e=[],b=function(){var c=e.shift();if(c){var k=c[0],f=c[1]||0,c=c[2]||0;k in this.cache&&this.play(k);d=setTimeout(a(this,b),f+c)}else d=null};return function(c){for(var k=0;k<c.length;k++)e.push(c[k]);null==d&&(d=setTimeout(a(this,b),0))}}();h.SoundCache=d},{}],19:[function(f,n,h){var a,d,g,e,b=function(a,b){function e(){this.constructor=a}for(var d in b)c.call(b,d)&&(a[d]=
b[d]);e.prototype=b.prototype;a.prototype=new e;a.__super__=b.prototype;return a},c={}.hasOwnProperty,k=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},u=[].slice;e=function(a){return a.substr(0,1).toUpperCase()+a.slice(1)};g=function(b){var c,e,d;e=[];for(c in b)d=b[c],e.push(new a(c,d));return e};d=function(a){function c(){c.__super__.constructor.apply(this,arguments)}b(c,a);return c}(Error);a=function(){return function(a,b,c){this.froms=a;
this.to=b;this.name=c;this.froms instanceof Array||(this.froms=[this.froms]);this.name=this.name||"do"+e(this.to)}}();f=function(){function a(b,c,e){var d;this.ctx=null!=c?c:this;this.stateData=null!=e?e:[];d=g(b);if(0===d.length)throw Error("Must initialize with at least one transition");this.state=d[0].froms[0];this.stateData instanceof Array||(this.stateData=[this.stateData]);b=0;for(c=d.length;b<c;b++)e=d[b],this.makeEvent(e)}a.prototype.makeEvent=function(a){return this[a.name]=function(b){return function(){var c;
if(c=b.state,0>k.call(a.froms,c))throw new d("Not a valid transition");b.stateData=b.invoke.apply(b,["leave",b.state,a].concat(u.call(b.stateData)));b.stateData=b.invoke.apply(b,["enter",a.to,a].concat(u.call(b.stateData)));return b.state=a.to}}(this)};a.prototype.invoke=function(){var a,b,c,d,k;b=arguments[0];d=arguments[1];k=arguments[2];a=4<=arguments.length?u.call(arguments,3):[];b+=e(d);return this.ctx[b]?(a=(c=this.ctx)[b].apply(c,[k].concat(u.call(a))),"undefined"===typeof a&&(a=[]),a instanceof
Array?a:[a]):a};return a}();h.TransitionError=d;h.Transition=a;h.StateM=f},{}],20:[function(f,n,h){function a(e,b){if(!(this instanceof a))return new a(e,b);var c=b;Object.defineProperties(this,{_currentState:{get:function(){return c},set:function(a){c=a}},currentState:{enumerable:!0,get:function(){return c}},states:{enumerable:!0,value:e},transitions:{enumerable:!0,value:[]}});Object.freeze(this)}function d(a,b){Object.defineProperties(this,{from:{enumerable:!0,value:a},to:{enumerable:!0,value:b}})}
function g(a,b){if(!(this instanceof g))return new g(a,b);Error.call(this);d.call(this,a,b);Object.defineProperties(this,{message:{enumerable:!0,value:"Invalid transition from "+("string"===typeof a?'"'+a+'"':"null")+' to "'+b+'"'}});Object.freeze(this)}f=f("util").inherits;a.prototype.transition=function(a){var b=this.currentState,c=this.states[b],b=c&&-1!==c.indexOf(a)?new d(b,a):new g(b,a);this.transitions.push(b);this._currentState=a;if(b instanceof g)throw b;return this};f(g,Error);n.exports=
a},{util:31}],21:[function(f,n,h){(function(a){function d(a){if(!(this instanceof d))return new d(a);this.message=a}function g(a){return function(){var b=Array.prototype.slice.call(arguments,0);a.memo=a.memo||{};return a.memo[b]?a.memo[b]:a.memo[b]=a.apply(null,b)}}function e(a){a=a.split(".");if(3!=a.length)throw new d("Wrong number of segments");return D(a[1])}function b(a){if(""==a)return{};if(-1==a.indexOf("&")&&-1==a.indexOf("="))return a;a=a.split("&");for(var c={},e=0;e<a.length;e++){var d=
a[e].split("=");c[decodeURIComponent(d[0])]=b(decodeURIComponent(d[1]))}return c}function c(b){try{return btoa(b)}catch(c){try{return(new a(b)).toString("base64")}catch(e){return r.encode(b)}}}function k(b){try{return atob(b)}catch(c){try{return(new a(b,"base64")).toString("ascii")}catch(e){return r.decode(b)}}}function u(a){var b=[],c;for(c in a){var e="object"==typeof a[c]?u(a[c]):a[c];b.push(encodeURIComponent(c)+"="+encodeURIComponent(e))}return b.join("&")}function l(a){var b=f("./rtc");return(a?
a.options.rtc:1)&&b.enabled()?l.WEBRTC:l.FLASH}function t(){var a=t.UNKNOWN,b=999;if("undefined"!==typeof navigator)if(navigator.mozGetUserMedia){a=t.FIREFOX;try{b=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1],10)}catch(c){}}else if(navigator.webkitGetUserMedia){var a=t.CHROME,e=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);if(null!==e)try{b=parseInt(e[2],10)}catch(d){}}return[a,b]}function C(a,b){return a===b?!0:typeof a!==typeof b?!1:a instanceof Date&&b instanceof Date?a.getTime()===
b.getTime():"object"!==typeof a&&"object"!==typeof b?a==b:n(a,b)}function n(a,b){if(void 0===a||null===a||void 0===b||null===b||a.prototype!==b.prototype)return!1;try{var c=q(a),e=q(b)}catch(d){return!1}if(c.length!==e.length)return!1;c.sort();e.sort();for(e=c.length-1;0<=e;e--){var k=c[e];if(!C(a[k],b[k]))return!1}return!0}var v=f("events").EventEmitter;JSON="undefined"!==typeof JSON?JSON:f("../../vendor/json2");var r=f("../../vendor/base64"),x=f("../../vendor/swfobject").swfobject;d.prototype.toString=
function(){return"Twilio.Exception: "+this.message};var D=g(function(a){var b=a.length%4;0<b&&(a+=Array(4-b+1).join("="));a=a.replace(/-/g,"+").replace(/_/g,"/");a=k(a);return JSON.parse(a)}),B=g(function(a){a=e(a);for(var c=0===a.scope.length?[]:a.scope.split(" "),q={},k=0;k<c.length;k++){var g;g=c[k].match(/^scope:(\w+):(\w+)\??(.*)$/);if(!g||4!=g.length)throw new d("Bad scope URI");g={service:g[1],privilege:g[2],params:b(g[3])};q[g.service+":"+g.privilege]=g}a.scope=q;return a}),p=function(){function a(){this.set=
{}}a.prototype.clear=function(){this.set={}};a.prototype.put=function(b){return this.set[b]=a.DUMMY};a.prototype.del=function(a){return delete this.set[a]};a.prototype.map=function(a,b){var c=[],e;for(e in this.set)c.push(a.call(b,e));return c};a.DUMMY={};return a}(),E="";l.FLASH="Flash";l.WEBRTC="WebRTC";t.CHROME="chrome";t.FIREFOX="firefox";t.UNKNOWN="unknown";var q="function"===typeof Object.keys?Object.keys:function(a){var b=[],c;for(c in a)b.push(c);return b};h.getSDKVersion=function(){return"1.2"};
h.encodescope=function(a,b,c){a=["scope",a,b].join(":");b=!0;for(var e in c){b=!1;break}return b?a:a+"?"+u(c)};h.dummyToken=function(a){var b={iss:"AC1111111111111111111111111111111",exp:14E8},e;for(e in b)a[e]=a[e]||b[e];a=c(JSON.stringify(a));a=a.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");return["*",a,"*"].join(".")};h.Exception=d;h.decode=e;h.btoa=c;h.atob=k;h.objectize=B;h.urlencode=function(a,b){var c=[];b=b||!1;for(var e in a)if(b&&a[e]instanceof Array)for(var d in a[e]){var q=a[e][d];
c.push(encodeURIComponent(e)+"="+encodeURIComponent(q))}else q=a[e],c.push(encodeURIComponent(e)+"="+encodeURIComponent(q));return c.join("&")};h.Set=p;h.bind=function(a,b){var c=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return a.apply(b,c.concat(e))}};h.getSystemInfo=function(){var a=f("./rtc"),b="undefined"!=typeof navigator?navigator:{},b={p:"browser",v:"1.2",h:"5c1f1e8",browser:{userAgent:b.userAgent||"unknown",platform:b.platform||"unknown"}};
a.enabled()?b.plugin="rtc":(b.plugin="flash",b.flash={v:x.getFlashPlayerVersion()});return b};h.splitObjects=function(a,b){var c;c="string"!=typeof a?"":a.trim?a.trim():a.replace(/^\s+|\s+$/g,"");return 0==c.length?[]:c.split("\n")};h.generateConnectionUUID=function(){return"TJSxxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};h.getTwilioRoot=function(){return E};h.setTwilioRoot=function(a){E=a};h.getMediaEngine=l;h.mixinGetMediaEngine=
function(a){a.getMediaEngine=function(){return l(this)};a.getMediaEngine.FLASH=l.FLASH;a.getMediaEngine.WEBRTC=l.WEBRTC;return a};h.monitorEventEmitter=function(a,b){function c(e){var d=v.listenerCount(b,e);e="The number of "+e+" listeners on "+a+" exceeds the recommended number of 10. While twilio.js will continue to function normally, this may be indicative of an application error. Note that "+e+" listeners exist for the lifetime of the "+a+".";10<=d&&("undefined"!==typeof console&&(console.warn?
console.warn(e):console.log&&console.log(e)),b.removeListener("newListener",c))}b.setMaxListeners(0);b.on("newListener",c)};h.detectBrowser=t;h.deepEqual=C}).call(this,f("buffer").Buffer)},{"../../vendor/base64":33,"../../vendor/json2":34,"../../vendor/swfobject":37,"./rtc":14,buffer:23,events:27}],22:[function(f,n,h){function a(b){var c=this instanceof a?this:new a(b);c.sock=null;var e=function(){};c.onopen=e;c.onclose=e;c.onmessage=e;c.onerror=e;e={logPrefix:"[WSTransport]",host:"chunderw-gll.twilio.com",
reconnect:!0,debug:!1,secureSignaling:!0};b=b||{};for(var d in e)d in b||(b[d]=e[d]);c.options=b;g.mixinLog(c,c.options.logPrefix);c.log.enabled=c.options.debug;c.defaultReconnect=c.options.reconnect;c.uri=(c.options.secureSignaling?"wss://":"ws://")+c.options.host+"/signal";return c}var d=f("./heartbeat").Heartbeat,g=f("./log"),e=f("../../vendor/web-socket-js/web_socket").WebSocket;a.prototype.msgQueue=[];a.prototype.open=function(a){this.log("Opening socket");this.sock&&2>this.sock.readyState?this.log("Socket already open."):
(this.options.reconnect=this.defaultReconnect,this.heartbeat&&(this.heartbeat.onsleep=function(){}),this.heartbeat=new d({interval:15}),this.sock=this._connect(a))};a.prototype.send=function(a){if(this.sock)if(0==this.sock.readyState)this.msgQueue.push(a);else try{this.sock.send(a)}catch(c){this.log("Error while sending. Closing socket: "+c.message),this.sock.close()}};a.prototype.close=function(){this.log("Closing socket");this.options.reconnect=!1;this.sock&&(this.sock.close(),this.sock=null);this.heartbeat.onsleep=
function(){}};a.prototype._cleanupSocket=function(a){if(a){this.log("Cleaning up socket");var c=function(){};a.onopen=function(){a.close()};a.onmessage=c;a.onerror=c;a.onclose=c;2>a.readyState&&a.close()}};a.prototype._connect=function(a){var c=++a||1;this.log("attempting to connect");var d=null;try{d=new e(this.uri)}catch(g){this.onerror({code:31E3,message:g.message||"Could not connect to "+this.uri});this.close();return}var f=this,h=this.sock,n=null,y=setTimeout(function(){f.log("connection attempt timed out");
d.onclose=function(){};d.close();f.onclose();f._tryReconnect(c)},5E3);d.onopen=function(){clearTimeout(y);f._cleanupSocket(h);n=(new Date).getTime();f.log("Socket opened");f.heartbeat.onsleep=function(){f.log("Heartbeat timed out. closing socket");f.sock.onclose=function(){};f.sock.close();f.onclose();f._tryReconnect(c)};f.heartbeat.beat();f.onopen();for(var a=0;a<f.msgQueue.length;a++)f.sock.send(f.msgQueue[a]);f.msgQueue=[]};d.onclose=function(){clearTimeout(y);f._cleanupSocket(h);f.heartbeat.onsleep=
function(){};n&&10<((new Date).getTime()-n)/1E3&&(c=1);f.log("Socket closed");f.onclose();f._tryReconnect(c)};d.onerror=function(a){f.log("Socket received error: "+a.message);f.onerror({code:31E3,message:a.message||"WSTransport socket error"})};d.onmessage=function(a){f.heartbeat.beat();if("\n"==a.data)f.send("\n");else f.onmessage(a)};return d};a.prototype._tryReconnect=function(a){a=a||0;if(this.options.reconnect){this.log("Attempting to reconnect.");var c=this,e=0;5>a?(e=50*Math.pow(2,a),e=30+
Math.round(Math.random()*e)):e=3E3;setTimeout(function(){c.open(a)},e)}};h.WSTransport=a},{"../../vendor/web-socket-js/web_socket":38,"./heartbeat":7,"./log":8}],23:[function(f,n,h){function a(b,c,e){if(!(this instanceof a))return new a(b,c,e);var d=typeof b,g;if("number"===d)g=0<b?b>>>0:0;else if("string"===d){if("base64"===c)for(b=(b.trim?b.trim():b.replace(/^\s+|\s+$/g,"")).replace(E,"");0!==b.length%4;)b+="=";g=a.byteLength(b,c)}else if("object"===d&&null!==b)"Buffer"===b.type&&D(b.data)&&(b=
b.data),g=0<+b.length?Math.floor(+b.length):0;else throw new TypeError("must start with number, buffer, array or string");if(this.length>B)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+B.toString(16)+" bytes");var k;a.TYPED_ARRAY_SUPPORT?k=a._augment(new Uint8Array(g)):(k=this,k.length=g,k._isBuffer=!0);if(a.TYPED_ARRAY_SUPPORT&&"number"===typeof b.byteLength)k._set(b);else{var f=b;if(D(f)||a.isBuffer(f)||f&&"object"===typeof f&&"number"===typeof f.length)if(a.isBuffer(b))for(c=
0;c<g;c++)k[c]=b.readUInt8(c);else for(c=0;c<g;c++)k[c]=(b[c]%256+256)%256;else if("string"===d)k.write(b,0,c);else if("number"===d&&!a.TYPED_ARRAY_SUPPORT&&!e)for(c=0;c<g;c++)k[c]=0}return k}function d(a,b,c){var e="";for(c=Math.min(a.length,c);b<c;b++)e+=String.fromCharCode(a[b]);return e}function g(a,b,c){if(0!==a%1||0>a)throw new RangeError("offset is not uint");if(a+b>c)throw new RangeError("Trying to access beyond buffer length");}function e(b,c,e,d,g,k){if(!a.isBuffer(b))throw new TypeError("buffer must be a Buffer instance");
if(c>g||c<k)throw new TypeError("value is out of bounds");if(e+d>b.length)throw new TypeError("index out of range");}function b(a,b,c,e){0>b&&(b=65535+b+1);for(var d=0,g=Math.min(a.length-c,2);d<g;d++)a[c+d]=(b&255<<8*(e?d:1-d))>>>8*(e?d:1-d)}function c(a,b,c,e){0>b&&(b=4294967295+b+1);for(var d=0,g=Math.min(a.length-c,4);d<g;d++)a[c+d]=b>>>8*(e?d:3-d)&255}function k(a,b,c,e,d,g){if(b>d||b<g)throw new TypeError("value is out of bounds");if(c+e>a.length)throw new TypeError("index out of range");}function u(a,
b,c,e,d){d||k(a,b,c,4,3.4028234663852886E38,-3.4028234663852886E38);x.write(a,b,c,e,23,4);return c+4}function l(a,b,c,e,d){d||k(a,b,c,8,1.7976931348623157E308,-1.7976931348623157E308);x.write(a,b,c,e,52,8);return c+8}function t(a){for(var b=[],c=0;c<a.length;c++){var e=a.charCodeAt(c);if(127>=e)b.push(e);else{var d=c;55296<=e&&57343>=e&&c++;e=encodeURIComponent(a.slice(d,c+1)).substr(1).split("%");for(d=0;d<e.length;d++)b.push(parseInt(e[d],16))}}return b}function C(a){for(var b=[],c=0;c<a.length;c++)b.push(a.charCodeAt(c)&
255);return b}function y(a,b,c,e,d){d&&(e-=e%d);for(d=0;d<e&&!(d+c>=b.length||d>=a.length);d++)b[d+c]=a[d];return d}function v(a){try{return decodeURIComponent(a)}catch(b){return String.fromCharCode(65533)}}var r=f("base64-js"),x=f("ieee754"),D=f("is-array");h.Buffer=a;h.SlowBuffer=a;h.INSPECT_MAX_BYTES=50;a.poolSize=8192;var B=1073741823;a.TYPED_ARRAY_SUPPORT=function(){try{var a=new ArrayBuffer(0),b=new Uint8Array(a);b.foo=function(){return 42};return 42===b.foo()&&"function"===typeof b.subarray&&
0===(new Uint8Array(1)).subarray(1,1).byteLength}catch(c){return!1}}();a.isBuffer=function(a){return!(null==a||!a._isBuffer)};a.compare=function(b,c){if(!a.isBuffer(b)||!a.isBuffer(c))throw new TypeError("Arguments must be Buffers");for(var e=b.length,d=c.length,g=0,k=Math.min(e,d);g<k&&b[g]===c[g];g++);g!==k&&(e=b[g],d=c[g]);return e<d?-1:d<e?1:0};a.isEncoding=function(a){switch(String(a).toLowerCase()){case "hex":case "utf8":case "utf-8":case "ascii":case "binary":case "base64":case "raw":case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":return!0;
default:return!1}};a.concat=function(b,c){if(!D(b))throw new TypeError("Usage: Buffer.concat(list[, length])");if(0===b.length)return new a(0);if(1===b.length)return b[0];var e;if(void 0===c)for(e=c=0;e<b.length;e++)c+=b[e].length;var d=new a(c),g=0;for(e=0;e<b.length;e++){var k=b[e];k.copy(d,g);g+=k.length}return d};a.byteLength=function(a,b){var c;a+="";switch(b||"utf8"){case "ascii":case "binary":case "raw":c=a.length;break;case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":c=2*a.length;break;
case "hex":c=a.length>>>1;break;case "utf8":case "utf-8":c=t(a).length;break;case "base64":c=r.toByteArray(a).length;break;default:c=a.length}return c};a.prototype.length=void 0;a.prototype.parent=void 0;a.prototype.toString=function(a,b,c){var e=!1;b>>>=0;c=void 0===c||Infinity===c?this.length:c>>>0;a||(a="utf8");0>b&&(b=0);c>this.length&&(c=this.length);if(c<=b)return"";for(;;)switch(a){case "hex":a=b;b=this.length;if(!a||0>a)a=0;if(!c||0>c||c>b)c=b;for(b="";a<c;a++)e=this[a],e=16>e?"0"+e.toString(16):
e.toString(16),b+=e;return b;case "utf8":case "utf-8":a=b;e=b="";for(c=Math.min(this.length,c);a<c;a++)127>=this[a]?(b+=v(e)+String.fromCharCode(this[a]),e=""):e+="%"+this[a].toString(16);return b+v(e);case "ascii":return d(this,b,c);case "binary":return d(this,b,c);case "base64":return a=b,c=0===a&&c===this.length?r.fromByteArray(this):r.fromByteArray(this.slice(a,c)),c;case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":c=this.slice(b,c);a="";for(b=0;b<c.length;b+=2)a+=String.fromCharCode(c[b]+
256*c[b+1]);return a;default:if(e)throw new TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase();e=!0}};a.prototype.equals=function(b){if(!a.isBuffer(b))throw new TypeError("Argument must be a Buffer");return 0===a.compare(this,b)};a.prototype.inspect=function(){var a="",b=h.INSPECT_MAX_BYTES;0<this.length&&(a=this.toString("hex",0,b).match(/.{2}/g).join(" "),this.length>b&&(a+=" ... "));return"<Buffer "+a+">"};a.prototype.compare=function(b){if(!a.isBuffer(b))throw new TypeError("Argument must be a Buffer");
return a.compare(this,b)};a.prototype.get=function(a){console.log(".get() is deprecated. Access using array indexes instead.");return this.readUInt8(a)};a.prototype.set=function(a,b){console.log(".set() is deprecated. Access using array indexes instead.");return this.writeUInt8(a,b)};a.prototype.write=function(a,b,c,e){if(isFinite(b))isFinite(c)||(e=c,c=void 0);else{var d=e;e=b;b=c;c=d}b=Number(b)||0;d=this.length-b;c?(c=Number(c),c>d&&(c=d)):c=d;e=String(e||"utf8").toLowerCase();switch(e){case "hex":b=
Number(b)||0;e=this.length-b;c?(c=Number(c),c>e&&(c=e)):c=e;e=a.length;if(0!==e%2)throw Error("Invalid hex string");c>e/2&&(c=e/2);for(e=0;e<c;e++){d=parseInt(a.substr(2*e,2),16);if(isNaN(d))throw Error("Invalid hex string");this[b+e]=d}a=e;break;case "utf8":case "utf-8":a=y(t(a),this,b,c);break;case "ascii":a=y(C(a),this,b,c);break;case "binary":a=y(C(a),this,b,c);break;case "base64":a=y(r.toByteArray(a),this,b,c);break;case "ucs2":case "ucs-2":case "utf16le":case "utf-16le":for(var g,d=[],k=0;k<
a.length;k++)g=a.charCodeAt(k),e=g>>8,g%=256,d.push(g),d.push(e);a=y(d,this,b,c,2);break;default:throw new TypeError("Unknown encoding: "+e);}return a};a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};a.prototype.slice=function(b,c){var e=this.length;b=~~b;c=void 0===c?e:~~c;0>b?(b+=e,0>b&&(b=0)):b>e&&(b=e);0>c?(c+=e,0>c&&(c=0)):c>e&&(c=e);c<b&&(c=b);if(a.TYPED_ARRAY_SUPPORT)return a._augment(this.subarray(b,c));for(var e=c-b,d=new a(e,void 0,
!0),g=0;g<e;g++)d[g]=this[g+b];return d};a.prototype.readUInt8=function(a,b){b||g(a,1,this.length);return this[a]};a.prototype.readUInt16LE=function(a,b){b||g(a,2,this.length);return this[a]|this[a+1]<<8};a.prototype.readUInt16BE=function(a,b){b||g(a,2,this.length);return this[a]<<8|this[a+1]};a.prototype.readUInt32LE=function(a,b){b||g(a,4,this.length);return(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]};a.prototype.readUInt32BE=function(a,b){b||g(a,4,this.length);return 16777216*this[a]+
(this[a+1]<<16|this[a+2]<<8|this[a+3])};a.prototype.readInt8=function(a,b){b||g(a,1,this.length);return this[a]&128?-1*(255-this[a]+1):this[a]};a.prototype.readInt16LE=function(a,b){b||g(a,2,this.length);var c=this[a]|this[a+1]<<8;return c&32768?c|4294901760:c};a.prototype.readInt16BE=function(a,b){b||g(a,2,this.length);var c=this[a+1]|this[a]<<8;return c&32768?c|4294901760:c};a.prototype.readInt32LE=function(a,b){b||g(a,4,this.length);return this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24};a.prototype.readInt32BE=
function(a,b){b||g(a,4,this.length);return this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]};a.prototype.readFloatLE=function(a,b){b||g(a,4,this.length);return x.read(this,a,!0,23,4)};a.prototype.readFloatBE=function(a,b){b||g(a,4,this.length);return x.read(this,a,!1,23,4)};a.prototype.readDoubleLE=function(a,b){b||g(a,8,this.length);return x.read(this,a,!0,52,8)};a.prototype.readDoubleBE=function(a,b){b||g(a,8,this.length);return x.read(this,a,!1,52,8)};a.prototype.writeUInt8=function(b,c,d){b=+b;
c>>>=0;d||e(this,b,c,1,255,0);a.TYPED_ARRAY_SUPPORT||(b=Math.floor(b));this[c]=b;return c+1};a.prototype.writeUInt16LE=function(c,d,g){c=+c;d>>>=0;g||e(this,c,d,2,65535,0);a.TYPED_ARRAY_SUPPORT?(this[d]=c,this[d+1]=c>>>8):b(this,c,d,!0);return d+2};a.prototype.writeUInt16BE=function(c,d,g){c=+c;d>>>=0;g||e(this,c,d,2,65535,0);a.TYPED_ARRAY_SUPPORT?(this[d]=c>>>8,this[d+1]=c):b(this,c,d,!1);return d+2};a.prototype.writeUInt32LE=function(b,d,g){b=+b;d>>>=0;g||e(this,b,d,4,4294967295,0);a.TYPED_ARRAY_SUPPORT?
(this[d+3]=b>>>24,this[d+2]=b>>>16,this[d+1]=b>>>8,this[d]=b):c(this,b,d,!0);return d+4};a.prototype.writeUInt32BE=function(b,d,g){b=+b;d>>>=0;g||e(this,b,d,4,4294967295,0);a.TYPED_ARRAY_SUPPORT?(this[d]=b>>>24,this[d+1]=b>>>16,this[d+2]=b>>>8,this[d+3]=b):c(this,b,d,!1);return d+4};a.prototype.writeInt8=function(b,c,d){b=+b;c>>>=0;d||e(this,b,c,1,127,-128);a.TYPED_ARRAY_SUPPORT||(b=Math.floor(b));0>b&&(b=255+b+1);this[c]=b;return c+1};a.prototype.writeInt16LE=function(c,d,g){c=+c;d>>>=0;g||e(this,
c,d,2,32767,-32768);a.TYPED_ARRAY_SUPPORT?(this[d]=c,this[d+1]=c>>>8):b(this,c,d,!0);return d+2};a.prototype.writeInt16BE=function(c,d,g){c=+c;d>>>=0;g||e(this,c,d,2,32767,-32768);a.TYPED_ARRAY_SUPPORT?(this[d]=c>>>8,this[d+1]=c):b(this,c,d,!1);return d+2};a.prototype.writeInt32LE=function(b,d,g){b=+b;d>>>=0;g||e(this,b,d,4,2147483647,-2147483648);a.TYPED_ARRAY_SUPPORT?(this[d]=b,this[d+1]=b>>>8,this[d+2]=b>>>16,this[d+3]=b>>>24):c(this,b,d,!0);return d+4};a.prototype.writeInt32BE=function(b,d,g){b=
+b;d>>>=0;g||e(this,b,d,4,2147483647,-2147483648);0>b&&(b=4294967295+b+1);a.TYPED_ARRAY_SUPPORT?(this[d]=b>>>24,this[d+1]=b>>>16,this[d+2]=b>>>8,this[d+3]=b):c(this,b,d,!1);return d+4};a.prototype.writeFloatLE=function(a,b,c){return u(this,a,b,!0,c)};a.prototype.writeFloatBE=function(a,b,c){return u(this,a,b,!1,c)};a.prototype.writeDoubleLE=function(a,b,c){return l(this,a,b,!0,c)};a.prototype.writeDoubleBE=function(a,b,c){return l(this,a,b,!1,c)};a.prototype.copy=function(b,c,d,e){d||(d=0);e||0===
e||(e=this.length);c||(c=0);if(e!==d&&0!==b.length&&0!==this.length){if(e<d)throw new TypeError("sourceEnd < sourceStart");if(0>c||c>=b.length)throw new TypeError("targetStart out of bounds");if(0>d||d>=this.length)throw new TypeError("sourceStart out of bounds");if(0>e||e>this.length)throw new TypeError("sourceEnd out of bounds");e>this.length&&(e=this.length);b.length-c<e-d&&(e=b.length-c+d);e-=d;if(1E3>e||!a.TYPED_ARRAY_SUPPORT)for(var g=0;g<e;g++)b[g+c]=this[g+d];else b._set(this.subarray(d,d+
e),c)}};a.prototype.fill=function(a,b,c){a||(a=0);b||(b=0);c||(c=this.length);if(c<b)throw new TypeError("end < start");if(c!==b&&0!==this.length){if(0>b||b>=this.length)throw new TypeError("start out of bounds");if(0>c||c>this.length)throw new TypeError("end out of bounds");if("number"===typeof a)for(;b<c;b++)this[b]=a;else{a=t(a.toString());for(var e=a.length;b<c;b++)this[b]=a[b%e]}return this}};a.prototype.toArrayBuffer=function(){if("undefined"!==typeof Uint8Array){if(a.TYPED_ARRAY_SUPPORT)return(new a(this)).buffer;
for(var b=new Uint8Array(this.length),c=0,e=b.length;c<e;c+=1)b[c]=this[c];return b.buffer}throw new TypeError("Buffer.toArrayBuffer not supported in this browser");};var p=a.prototype;a._augment=function(b){b.constructor=a;b._isBuffer=!0;b._get=b.get;b._set=b.set;b.get=p.get;b.set=p.set;b.write=p.write;b.toString=p.toString;b.toLocaleString=p.toString;b.toJSON=p.toJSON;b.equals=p.equals;b.compare=p.compare;b.copy=p.copy;b.slice=p.slice;b.readUInt8=p.readUInt8;b.readUInt16LE=p.readUInt16LE;b.readUInt16BE=
p.readUInt16BE;b.readUInt32LE=p.readUInt32LE;b.readUInt32BE=p.readUInt32BE;b.readInt8=p.readInt8;b.readInt16LE=p.readInt16LE;b.readInt16BE=p.readInt16BE;b.readInt32LE=p.readInt32LE;b.readInt32BE=p.readInt32BE;b.readFloatLE=p.readFloatLE;b.readFloatBE=p.readFloatBE;b.readDoubleLE=p.readDoubleLE;b.readDoubleBE=p.readDoubleBE;b.writeUInt8=p.writeUInt8;b.writeUInt16LE=p.writeUInt16LE;b.writeUInt16BE=p.writeUInt16BE;b.writeUInt32LE=p.writeUInt32LE;b.writeUInt32BE=p.writeUInt32BE;b.writeInt8=p.writeInt8;
b.writeInt16LE=p.writeInt16LE;b.writeInt16BE=p.writeInt16BE;b.writeInt32LE=p.writeInt32LE;b.writeInt32BE=p.writeInt32BE;b.writeFloatLE=p.writeFloatLE;b.writeFloatBE=p.writeFloatBE;b.writeDoubleLE=p.writeDoubleLE;b.writeDoubleBE=p.writeDoubleBE;b.fill=p.fill;b.inspect=p.inspect;b.toArrayBuffer=p.toArrayBuffer;return b};var E=/[^+\/0-9A-z]/g},{"base64-js":24,ieee754:25,"is-array":26}],24:[function(f,n,h){(function(a){function d(a){a=a.charCodeAt(0);if(43===a)return 62;if(47===a)return 63;if(48>a)return-1;
if(58>a)return a-48+52;if(91>a)return a-65;if(123>a)return a-97+26}var g="undefined"!==typeof Uint8Array?Uint8Array:Array;a.toByteArray=function(a){function b(a){h[n++]=a}var c,k,f,l,h;if(0<a.length%4)throw Error("Invalid string. Length must be a multiple of 4");c=a.length;l="="===a.charAt(c-2)?2:"="===a.charAt(c-1)?1:0;h=new g(3*a.length/4-l);k=0<l?a.length-4:a.length;var n=0;for(c=0;c<k;c+=4)f=d(a.charAt(c))<<18|d(a.charAt(c+1))<<12|d(a.charAt(c+2))<<6|d(a.charAt(c+3)),b((f&16711680)>>16),b((f&
65280)>>8),b(f&255);2===l?(f=d(a.charAt(c))<<2|d(a.charAt(c+1))>>4,b(f&255)):1===l&&(f=d(a.charAt(c))<<10|d(a.charAt(c+1))<<4|d(a.charAt(c+2))>>2,b(f>>8&255),b(f&255));return h};a.fromByteArray=function(a){var b,c=a.length%3,d="",g,f;b=0;for(f=a.length-c;b<f;b+=3)g=(a[b]<<16)+(a[b+1]<<8)+a[b+2],g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g>>18&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g>>12&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g>>
6&63)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g&63),d+=g;switch(c){case 1:g=a[a.length-1];d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g>>2);d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g<<4&63);d+="==";break;case 2:g=(a[a.length-2]<<8)+a[a.length-1],d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g>>10),d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g>>
4&63),d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(g<<2&63),d+="="}return d}})("undefined"===typeof h?this.base64js={}:h)},{}],25:[function(f,n,h){h.read=function(a,d,g,e,b){var c;c=8*b-e-1;var k=(1<<c)-1,f=k>>1,l=-7;b=g?b-1:0;var h=g?-1:1,n=a[d+b];b+=h;g=n&(1<<-l)-1;n>>=-l;for(l+=c;0<l;g=256*g+a[d+b],b+=h,l-=8);c=g&(1<<-l)-1;g>>=-l;for(l+=e;0<l;c=256*c+a[d+b],b+=h,l-=8);if(0===g)g=1-f;else{if(g===k)return c?NaN:Infinity*(n?-1:1);c+=Math.pow(2,e);g-=f}return(n?-1:1)*
c*Math.pow(2,g-e)};h.write=function(a,d,g,e,b,c){var k,f=8*c-b-1,l=(1<<f)-1,h=l>>1,n=23===b?Math.pow(2,-24)-Math.pow(2,-77):0;c=e?0:c-1;var y=e?1:-1,v=0>d||0===d&&0>1/d?1:0;d=Math.abs(d);isNaN(d)||Infinity===d?(d=isNaN(d)?1:0,e=l):(e=Math.floor(Math.log(d)/Math.LN2),1>d*(k=Math.pow(2,-e))&&(e--,k*=2),d=1<=e+h?d+n/k:d+n*Math.pow(2,1-h),2<=d*k&&(e++,k/=2),e+h>=l?(d=0,e=l):1<=e+h?(d=(d*k-1)*Math.pow(2,b),e+=h):(d=d*Math.pow(2,h-1)*Math.pow(2,b),e=0));for(;8<=b;a[g+c]=d&255,c+=y,d/=256,b-=8);e=e<<b|d;
for(f+=b;0<f;a[g+c]=e&255,c+=y,e/=256,f-=8);a[g+c-y]|=128*v}},{}],26:[function(f,n,h){var a=Object.prototype.toString;n.exports=Array.isArray||function(d){return!!d&&"[object Array]"==a.call(d)}},{}],27:[function(f,n,h){function a(){this._events=this._events||{};this._maxListeners=this._maxListeners||void 0}function d(a){return"function"===typeof a}function g(a){return"object"===typeof a&&null!==a}n.exports=a;a.EventEmitter=a;a.prototype._events=void 0;a.prototype._maxListeners=void 0;a.defaultMaxListeners=
10;a.prototype.setMaxListeners=function(a){if("number"!==typeof a||0>a||isNaN(a))throw TypeError("n must be a positive number");this._maxListeners=a;return this};a.prototype.emit=function(a){var b,c,k,f;this._events||(this._events={});if("error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){b=arguments[1];if(b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.');}c=this._events[a];if(void 0===c)return!1;if(d(c))switch(arguments.length){case 1:c.call(this);
break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:b=arguments.length;k=Array(b-1);for(f=1;f<b;f++)k[f-1]=arguments[f];c.apply(this,k)}else if(g(c)){b=arguments.length;k=Array(b-1);for(f=1;f<b;f++)k[f-1]=arguments[f];c=c.slice();b=c.length;for(f=0;f<b;f++)c[f].apply(this,k)}return!0};a.prototype.addListener=function(e,b){var c;if(!d(b))throw TypeError("listener must be a function");this._events||(this._events={});this._events.newListener&&this.emit("newListener",
e,d(b.listener)?b.listener:b);this._events[e]?g(this._events[e])?this._events[e].push(b):this._events[e]=[this._events[e],b]:this._events[e]=b;g(this._events[e])&&!this._events[e].warned&&(c=void 0!==this._maxListeners?this._maxListeners:a.defaultMaxListeners)&&0<c&&this._events[e].length>c&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"===
typeof console.trace&&console.trace());return this};a.prototype.on=a.prototype.addListener;a.prototype.once=function(a,b){function c(){this.removeListener(a,c);g||(g=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var g=!1;c.listener=b;this.on(a,c);return this};a.prototype.removeListener=function(a,b){var c,f,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;c=this._events[a];h=c.length;f=-1;if(c===b||d(c.listener)&&
c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(;0<h--;)if(c[h]===b||c[h].listener&&c[h].listener===b){f=h;break}if(0>f)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(f,1);this._events.removeListener&&this.emit("removeListener",a,b)}return this};a.prototype.removeAllListeners=function(a){var b;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&
delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);this.removeAllListeners("removeListener");this._events={};return this}b=this._events[a];if(d(b))this.removeListener(a,b);else for(;b.length;)this.removeListener(a,b[b.length-1]);delete this._events[a];return this};a.prototype.listeners=function(a){return this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]};a.listenerCount=function(a,
b){return a._events&&a._events[b]?d(a._events[b])?1:a._events[b].length:0}},{}],28:[function(f,n,h){n.exports="function"===typeof Object.create?function(a,d){a.super_=d;a.prototype=Object.create(d.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:function(a,d){a.super_=d;var g=function(){};g.prototype=d.prototype;a.prototype=new g;a.prototype.constructor=a}},{}],29:[function(f,n,h){function a(){}f=n.exports={};f.nextTick=function(){if("undefined"!==typeof window&&window.setImmediate)return function(a){return window.setImmediate(a)};
if("undefined"!==typeof window&&window.postMessage&&window.addEventListener){var a=[];window.addEventListener("message",function(g){var e=g.source;e!==window&&null!==e||"process-tick"!==g.data||(g.stopPropagation(),0<a.length&&a.shift()())},!0);return function(g){a.push(g);window.postMessage("process-tick","*")}}return function(a){setTimeout(a,0)}}();f.title="browser";f.browser=!0;f.env={};f.argv=[];f.on=a;f.addListener=a;f.once=a;f.off=a;f.removeListener=a;f.removeAllListeners=a;f.emit=a;f.binding=
function(a){throw Error("process.binding is not supported");};f.cwd=function(){return"/"};f.chdir=function(a){throw Error("process.chdir is not supported");}},{}],30:[function(f,n,h){n.exports=function(a){return a&&"object"===typeof a&&"function"===typeof a.copy&&"function"===typeof a.fill&&"function"===typeof a.readUInt8}},{}],31:[function(f,n,h){(function(a,d){function g(a,c){var d={seen:[],stylize:b};3<=arguments.length&&(d.depth=arguments[2]);4<=arguments.length&&(d.colors=arguments[3]);r(c)?
d.showHidden=c:c&&h._extend(d,c);B(d.showHidden)&&(d.showHidden=!1);B(d.depth)&&(d.depth=2);B(d.colors)&&(d.colors=!1);B(d.customInspect)&&(d.customInspect=!0);d.colors&&(d.stylize=e);return k(d,a,d.depth)}function e(a,b){var c=g.styles[b];return c?"\u001b["+g.colors[c][0]+"m"+a+"\u001b["+g.colors[c][1]+"m":a}function b(a,b){return a}function c(a){var b={};a.forEach(function(a,c){b[a]=!0});return b}function k(a,b,d){if(a.customInspect&&b&&z(b.inspect)&&b.inspect!==h.inspect&&(!b.constructor||b.constructor.prototype!==
b)){var e=b.inspect(d,a);D(e)||(e=k(a,e,d));return e}if(e=u(a,b))return e;var g=Object.keys(b),f=c(g);a.showHidden&&(g=Object.getOwnPropertyNames(b));if(m(b)&&(0<=g.indexOf("message")||0<=g.indexOf("description")))return l(b);if(0===g.length){if(z(b))return a.stylize("[Function"+(b.name?": "+b.name:"")+"]","special");if(p(b))return a.stylize(RegExp.prototype.toString.call(b),"regexp");if(q(b))return a.stylize(Date.prototype.toString.call(b),"date");if(m(b))return l(b)}var e="",r=!1,x=["{","}"];v(b)&&
(r=!0,x=["[","]"]);z(b)&&(e=" [Function"+(b.name?": "+b.name:"")+"]");p(b)&&(e=" "+RegExp.prototype.toString.call(b));q(b)&&(e=" "+Date.prototype.toUTCString.call(b));m(b)&&(e=" "+l(b));if(0===g.length&&(!r||0==b.length))return x[0]+e+x[1];if(0>d)return p(b)?a.stylize(RegExp.prototype.toString.call(b),"regexp"):a.stylize("[Object]","special");a.seen.push(b);g=r?t(a,b,d,f,g):g.map(function(c){return n(a,b,d,f,c,r)});a.seen.pop();return y(g,e,x)}function u(a,b){if(B(b))return a.stylize("undefined",
"undefined");if(D(b)){var c="'"+JSON.stringify(b).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return a.stylize(c,"string")}if(x(b))return a.stylize(""+b,"number");if(r(b))return a.stylize(""+b,"boolean");if(null===b)return a.stylize("null","null")}function l(a){return"["+Error.prototype.toString.call(a)+"]"}function t(a,b,c,d,e){for(var g=[],f=0,k=b.length;f<k;++f)Object.prototype.hasOwnProperty.call(b,String(f))?g.push(n(a,b,c,d,String(f),!0)):g.push("");e.forEach(function(e){e.match(/^\d+$/)||
g.push(n(a,b,c,d,e,!0))});return g}function n(a,b,c,d,e,g){var f,l;b=Object.getOwnPropertyDescriptor(b,e)||{value:b[e]};b.get?l=b.set?a.stylize("[Getter/Setter]","special"):a.stylize("[Getter]","special"):b.set&&(l=a.stylize("[Setter]","special"));Object.prototype.hasOwnProperty.call(d,e)||(f="["+e+"]");l||(0>a.seen.indexOf(b.value)?(l=null===c?k(a,b.value,null):k(a,b.value,c-1),-1<l.indexOf("\n")&&(l=g?l.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+l.split("\n").map(function(a){return"   "+
a}).join("\n"))):l=a.stylize("[Circular]","special"));if(B(f)){if(g&&e.match(/^\d+$/))return l;f=JSON.stringify(""+e);f.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(f=f.substr(1,f.length-2),f=a.stylize(f,"name")):(f=f.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),f=a.stylize(f,"string"))}return f+": "+l}function y(a,b,c){var d=0;return 60<a.reduce(function(a,b){d++;0<=b.indexOf("\n")&&d++;return a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0)?c[0]+(""===b?"":b+"\n ")+" "+a.join(",\n  ")+
" "+c[1]:c[0]+b+" "+a.join(", ")+" "+c[1]}function v(a){return Array.isArray(a)}function r(a){return"boolean"===typeof a}function x(a){return"number"===typeof a}function D(a){return"string"===typeof a}function B(a){return void 0===a}function p(a){return E(a)&&"[object RegExp]"===Object.prototype.toString.call(a)}function E(a){return"object"===typeof a&&null!==a}function q(a){return E(a)&&"[object Date]"===Object.prototype.toString.call(a)}function m(a){return E(a)&&("[object Error]"===Object.prototype.toString.call(a)||
a instanceof Error)}function z(a){return"function"===typeof a}function A(a){return 10>a?"0"+a.toString(10):a.toString(10)}function L(){var a=new Date,b=[A(a.getHours()),A(a.getMinutes()),A(a.getSeconds())].join(":");return[a.getDate(),K[a.getMonth()],b].join(" ")}var F=/%[sdj%]/g;h.format=function(a){if(!D(a)){for(var b=[],c=0;c<arguments.length;c++)b.push(g(arguments[c]));return b.join(" ")}for(var c=1,d=arguments,e=d.length,b=String(a).replace(F,function(a){if("%%"===a)return"%";if(c>=e)return a;
switch(a){case "%s":return String(d[c++]);case "%d":return Number(d[c++]);case "%j":try{return JSON.stringify(d[c++])}catch(b){return"[Circular]"}default:return a}}),f=d[c];c<e;f=d[++c])b=null!==f&&E(f)?b+(" "+g(f)):b+(" "+f);return b};h.deprecate=function(b,c){if(B(d.process))return function(){return h.deprecate(b,c).apply(this,arguments)};if(!0===a.noDeprecation)return b;var e=!1;return function(){if(!e){if(a.throwDeprecation)throw Error(c);a.traceDeprecation?console.trace(c):console.error(c);e=
!0}return b.apply(this,arguments)}};var H={},G;h.debuglog=function(b){B(G)&&(G=a.env.NODE_DEBUG||"");b=b.toUpperCase();if(!H[b])if((new RegExp("\\b"+b+"\\b","i")).test(G)){var c=a.pid;H[b]=function(){var a=h.format.apply(h,arguments);console.error("%s %d: %s",b,c,a)}}else H[b]=function(){};return H[b]};h.inspect=g;g.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,
39]};g.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};h.isArray=v;h.isBoolean=r;h.isNull=function(a){return null===a};h.isNullOrUndefined=function(a){return null==a};h.isNumber=x;h.isString=D;h.isSymbol=function(a){return"symbol"===typeof a};h.isUndefined=B;h.isRegExp=p;h.isObject=E;h.isDate=q;h.isError=m;h.isFunction=z;h.isPrimitive=function(a){return null===a||"boolean"===typeof a||"number"===typeof a||"string"===
typeof a||"symbol"===typeof a||"undefined"===typeof a};h.isBuffer=f("./support/isBuffer");var K="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");h.log=function(){console.log("%s - %s",L(),h.format.apply(h,arguments))};h.inherits=f("inherits");h._extend=function(a,b){if(!b||!E(b))return a;for(var c=Object.keys(b),d=c.length;d--;)a[c[d]]=b[c[d]];return a}}).call(this,f("_process"),"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"./support/isBuffer":30,
_process:29,inherits:28}],32:[function(f,n,h){(function(a,d){"object"===typeof h?n.exports=d():"function"===typeof define&&define.amd?define(d):a.printStackTrace=d()})(this,function(){function a(d){d=d||{guess:!0};var g=d.e||null,e=!!d.guess,b=d.mode||null;d=new a.implementation;g=d.run(g,b);return e?d.guessAnonymousFunctions(g):g}a.implementation=function(){};a.implementation.prototype={run:function(a,g){a=a||this.createException();g=g||this.mode(a);return"other"===g?this.other(arguments.callee):
this[g](a)},createException:function(){try{this.undef()}catch(a){return a}},mode:function(a){return"undefined"!==typeof window&&-1<window.navigator.userAgent.indexOf("PhantomJS")?"phantomjs":a.arguments&&a.stack?"chrome":a.stack&&a.sourceURL?"safari":a.stack&&a.number?"ie":a.stack&&a.fileName?"firefox":a.message&&a["opera#sourceloc"]?!a.stacktrace||-1<a.message.indexOf("\n")&&a.message.split("\n").length>a.stacktrace.split("\n").length?"opera9":"opera10a":a.message&&a.stack&&a.stacktrace?0>a.stacktrace.indexOf("called from line")?
"opera10b":"opera11":a.stack&&!a.fileName?"chrome":"other"},instrumentFunction:function(d,g,e){d=d||window;var b=d[g];d[g]=function(){e.call(this,a().slice(4));return d[g]._instrumented.apply(this,arguments)};d[g]._instrumented=b},deinstrumentFunction:function(a,g){a[g].constructor===Function&&a[g]._instrumented&&a[g]._instrumented.constructor===Function&&(a[g]=a[g]._instrumented)},chrome:function(a){return(a.stack+"\n").replace(/^[\s\S]+?\s+at\s+/," at ").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,
"{anonymous}() ($1)$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}() ($1)").replace(/^(.+) \((.+)\)$/gm,"$1@$2").split("\n").slice(0,-1)},safari:function(a){return a.stack.replace(/\[native code\]\n/m,"").replace(/^(?=\w+Error\:).*$\n/m,"").replace(/^@/gm,"{anonymous}()@").split("\n")},ie:function(a){return a.stack.replace(/^\s*at\s+(.*)$/gm,"$1").replace(/^Anonymous function\s+/gm,"{anonymous}() ").replace(/^(.+)\s+\((.+)\)$/gm,"$1@$2").split("\n").slice(1)},firefox:function(a){return a.stack.replace(/(?:\n@:0)?\s+$/m,
"").replace(/^(?:\((\S*)\))?@/gm,"{anonymous}($1)@").split("\n")},opera11:function(a){var g=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/;a=a.stacktrace.split("\n");for(var e=[],b=0,c=a.length;b<c;b+=2){var f=g.exec(a[b]);if(f){var h=f[4]+":"+f[1]+":"+f[2],f=f[3]||"global code",f=f.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,"{anonymous}");e.push(f+"@"+h+" -- "+a[b+1].replace(/^\s+/,""))}}return e},opera10b:function(a){var g=/^(.*)@(.+):(\d+)$/;a=a.stacktrace.split("\n");
for(var e=[],b=0,c=a.length;b<c;b++){var f=g.exec(a[b]);f&&e.push((f[1]?f[1]+"()":"global code")+"@"+f[2]+":"+f[3])}return e},opera10a:function(a){var g=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i;a=a.stacktrace.split("\n");for(var e=[],b=0,c=a.length;b<c;b+=2){var f=g.exec(a[b]);f&&e.push((f[3]||"{anonymous}")+"()@"+f[2]+":"+f[1]+" -- "+a[b+1].replace(/^\s+/,""))}return e},opera9:function(a){var g=/Line (\d+).*script (?:in )?(\S+)/i;a=a.message.split("\n");for(var e=[],b=2,c=a.length;b<
c;b+=2){var f=g.exec(a[b]);f&&e.push("{anonymous}()@"+f[2]+":"+f[1]+" -- "+a[b+1].replace(/^\s+/,""))}return e},phantomjs:function(a){var g=/(\S+) \((\S+)\)/i;a=a.stack.split("\n");for(var e=[],b=1,c=a.length;b<c;b++){a[b]=a[b].replace(/^\s+at\s+/gm,"");var f=g.exec(a[b]);f?e.push(f[1]+"()@"+f[2]):e.push("{anonymous}()@"+a[b])}return e},other:function(a){for(var g=/function(?:\s+([\w$]+))?\s*\(/,e=[],b,c,f=Array.prototype.slice;a&&10>e.length;){b=g.test(a.toString())?RegExp.$1||"{anonymous}":"{anonymous}";
try{c=f.call(a.arguments||[])}catch(h){c=["Cannot access arguments: "+h]}e[e.length]=b+"("+this.stringifyArguments(c)+")";try{a=a.caller}catch(l){e[e.length]="Cannot access caller: "+l;break}}return e},stringifyArguments:function(a){for(var g=[],e=Array.prototype.slice,b=0;b<a.length;++b){var c=a[b];void 0===c?g[b]="undefined":null===c?g[b]="null":c.constructor&&(g[b]=c.constructor===Array?3>c.length?"["+this.stringifyArguments(c)+"]":"["+this.stringifyArguments(e.call(c,0,1))+"..."+this.stringifyArguments(e.call(c,
-1))+"]":c.constructor===Object?"#object":c.constructor===Function?"#function":c.constructor===String?'"'+c+'"':c.constructor===Number?c:"?")}return g.join(",")},sourceCache:{},ajax:function(a){var g=this.createXMLHTTPObject();if(g)try{return g.open("GET",a,!1),g.send(null),g.responseText}catch(e){}return""},createXMLHTTPObject:function(){for(var a,g=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},
function(){return new ActiveXObject("Microsoft.XMLHTTP")}],e=0;e<g.length;e++)try{return a=g[e](),this.createXMLHTTPObject=g[e],a}catch(b){}},isSameDomain:function(a){return"undefined"!==typeof location&&-1!==a.indexOf(location.hostname)},getSource:function(a){a in this.sourceCache||(this.sourceCache[a]=this.ajax(a).split("\n"));return this.sourceCache[a]},guessAnonymousFunctions:function(a){for(var g=0;g<a.length;++g){var e=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,b=a[g],c=/\{anonymous\}\(.*\)@(.*)/.exec(b);
if(c){var f=e.exec(c[1]);f&&(e=f[1],c=f[2],f=f[3]||0,e&&this.isSameDomain(e)&&c&&(e=this.guessAnonymousFunction(e,c,f),a[g]=b.replace("{anonymous}",e)))}}return a},guessAnonymousFunction:function(a,g,e){var b;try{b=this.findFunctionName(this.getSource(a),g)}catch(c){b="getSource failed with url: "+a+", exception: "+c.toString()}return b},findFunctionName:function(a,g){for(var e=/function\s+([^(]*?)\s*\(([^)]*)\)/,b=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/,c=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/,
f="",h,l=Math.min(g,20),t,n=0;n<l;++n)if(h=a[g-n-1],t=h.indexOf("//"),0<=t&&(h=h.substr(0,t)),h)if(f=h+f,(h=b.exec(f))&&h[1]||(h=e.exec(f))&&h[1]||(h=c.exec(f))&&h[1])return h[1];return"(?)"}};return a})},{}],33:[function(f,n,h){h.decode=function(a){var d,g,e,b,c,f=0,h=0;b="";var l=[];if(!a)return a;a+="";do d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(f++)),g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(f++)),b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(f++)),
c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(f++)),e=d<<18|g<<12|b<<6|c,d=e>>16&255,g=e>>8&255,e&=255,64==b?l[h++]=String.fromCharCode(d):64==c?l[h++]=String.fromCharCode(d,g):l[h++]=String.fromCharCode(d,g,e);while(f<a.length);b=l.join("");a=[];d=l=c=h=f=0;for(b+="";f<b.length;)c=b.charCodeAt(f),128>c?(a[h++]=String.fromCharCode(c),f++):191<c&&224>c?(l=b.charCodeAt(f+1),a[h++]=String.fromCharCode((c&31)<<6|l&63),f+=2):(l=b.charCodeAt(f+1),d=b.charCodeAt(f+
2),a[h++]=String.fromCharCode((c&15)<<12|(l&63)<<6|d&63),f+=3);return b=a.join("")};h.encode=function(a){var d,g,e,b,c=0,f=0,h="",h=[];if(!a)return a;a+="";if(null===a||"undefined"===typeof a)a="";else{a+="";d="";g=e=b=0;b=a.length;for(var l=0;l<b;l++){var t=a.charCodeAt(l),n=null;128>t?e++:n=127<t&&2048>t?String.fromCharCode(t>>6|192)+String.fromCharCode(t&63|128):String.fromCharCode(t>>12|224)+String.fromCharCode(t>>6&63|128)+String.fromCharCode(t&63|128);null!==n&&(e>g&&(d+=a.slice(g,e)),d+=n,
g=e=l+1)}e>g&&(d+=a.slice(g,b));a=d}do d=a.charCodeAt(c++),g=a.charCodeAt(c++),e=a.charCodeAt(c++),b=d<<16|g<<8|e,d=b>>18&63,g=b>>12&63,e=b>>6&63,b&=63,h[f++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(b);while(c<a.length);h=h.join("");
switch(a.length%3){case 1:h=h.slice(0,-2)+"==";break;case 2:h=h.slice(0,-1)+"="}return h}},{}],34:[function(f,n,h){this.JSON||(JSON=function(){function a(a){return 10>a?"0"+a:a}function d(a,b){var c,f,h,l;c=/["\\\x00-\x1f\x7f-\x9f]/g;var t;switch(typeof a){case "string":return c.test(a)?'"'+a.replace(c,function(a){var b=g[a];if(b)return b;b=a.charCodeAt();return"\\u00"+Math.floor(b/16).toString(16)+(b%16).toString(16)})+'"':'"'+a+'"';case "number":return isFinite(a)?String(a):"null";case "boolean":case "null":return String(a);
case "object":if(!a)return"null";if("function"===typeof a.toJSON)return d(a.toJSON());c=[];if("number"===typeof a.length&&!a.propertyIsEnumerable("length")){l=a.length;for(f=0;f<l;f+=1)c.push(d(a[f],b)||"null");return"["+c.join(",")+"]"}if(b)for(l=b.length,f=0;f<l;f+=1)h=b[f],"string"===typeof h&&(t=d(a[h],b))&&c.push(d(h)+":"+t);else for(h in a)"string"===typeof h&&(t=d(a[h],b))&&c.push(d(h)+":"+t);return"{"+c.join(",")+"}"}}Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+
1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z"};var g={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return{stringify:d,parse:function(a,b){function c(a,d){var e,f;if(d&&"object"===typeof d)for(e in d)Object.prototype.hasOwnProperty.apply(d,[e])&&(f=c(e,d[e]),void 0!==f&&(d[e]=f));return b(a,d)}var d;if(/^[\],:{}\s]*$/.test(a.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return d=eval("("+a+")"),"function"===typeof b?c("",d):d;throw new SyntaxError("parseJSON");}}}());n.exports=this.JSON||JSON},{}],35:[function(f,n,h){function a(b,d){if(!(this instanceof a))return new a(b,d);this.__id=a.__nextId++;var e=function(){};this.onconnected=this.onclose=this.onerror=this.onopen=e;this._uri=(b?"rtmps":"rtmp")+"://"+d+"/chunder";this.micAttached=!1;a.__instances[this.__id]=this;return this}function d(a,b){if(document.body){var e=document.createElement("div");
e.style.position="absolute";e.appendChild(a);document.body.appendChild(e);b()}else{e=function(){d(a,b)};try{window.addEventListener("load",e,!1)}catch(f){window.attachEvent("onload",e)}}}var g=f("../../lib/twilio/util"),e=f("../swfobject").swfobject;a.prototype={openHelper:function(b,d,e,f,g){var h=this;a.__queue(function(){a.getMicrophones().length==e?b("No microphone is available"):d?(a.isMicMuted()?(a.__queueResponseCB(function(a){f.closeDialog(a);a&&(h.exec("startCall"),h.onopen(h))}),f.showDialog()):
h.onconnected=function(){h.exec("startCall");h.onopen(h)},b()):(h.onconnected=function(){h.exec("startCall");h.onopen(h)},a.isMicMuted()?g(function(){a.isMicMuted()?b("User denied access to microphone.",31208):b()}):b())})},uri:function(){return this._uri},open:function(){var b=this,d=Array.prototype.slice.call(arguments);a.__queue(function(){a.__flash.open.apply(a.__flash,[b.__id].concat(d))})},exec:function(){var b=this,d=Array.prototype.slice.call(arguments);a.__queue(function(){a.__flash.exec.apply(a.__flash,
[b.__id].concat(d))})},close:function(){var b=this;a.__queue(function(){a.__flash.close(b.__id)})},play:function(){var b=this,d=Array.prototype.slice.call(arguments);a.__queue(function(){a.__flash.playStream.apply(a.__flash,[b.__id].concat(d))})},publish:function(b,d){var e=this;a.__queue(function(){a.__flash.publish(e.__id,b,d)})},attachAudio:function(b,d){var e=this;a.__queue(function(){a.__flash.attachAudio(e.__id,d);e.micAttached=!0;b&&"function"==typeof b&&b()})},detachAudio:function(b){var d=
this;a.__queue(function(){a.__flash.detachAudio(d.__id);d.micAttached=!1;b&&"function"==typeof b&&b()})},isAudioAttached:function(){return this.micAttached},__handleEvent:function(a){switch(a.type){case "gatewayError":case "securityError":case "asyncError":case "ioError":this.onerror.call(this,a);break;case "netStatus":this.__handleNetStatus(a);break;case "callsid":if("function"==typeof this.onCallSid)this.onCallSid(a.info.callsid)}},__handleNetStatus:function(b){a.log("Event info code: "+b.info.code);
switch(b.info.code){case "NetConnection.Connect.Failed":case "NetConnection.Connect.Rejected":a.log("Connection failed or was rejected");this.onerror.call(this,b);break;case "NetConnection.Connect.Closed":a.log("Connection closed");this.onclose.call(this,b);break;case "NetConnection.Connect.Success":a.log("Connection established");this.publish("input","live");this.attachAudio();this.onconnected();break;default:a.log("Unexpected event: "+b.info.code)}}};f={__queue:function(b){a.initialized?b():a.__tasks.push(b)},
__queueResponseCB:function(b){a.__responseCB.push(b)},initialize:function(b){if(!e.hasFlashPlayerVersion("10.0.0"))throw new g.Exception("Flash Player >= 10.0.0 is required.");if(!a.__flash)if(b=b||{},b.swfLocation=b.swfLocation||"MediaStreamMain.swf",b.domId=b.domId||"__connectionFlash__",b.loader=b.loader||d,document.body){var f=document.createElement("div");f.id=b.domId;b.loader(f,function(){a.__flash=f;var d={};"objectEnc"in b&&(d.objectEnc=b.objectEnc);d.namespace="Twilio.MediaStream";e.embedSWF(b.swfLocation,
b.domId,"215","138","10.0.0",null,d,{hasPriority:!0,allowScriptAccess:"always"},null,function(b){a.log("Embed "+(b.success?"succeeded":"failed"))})})}else try{window.addEventListener("load",function(){a.initialize(b)},!1)}catch(h){window.attachEvent("onload",function(){a.initialize(b)})}},setMicrophoneGain:function(b){a.__queue(function(){try{a.__flash.setMicrophoneGain(b)}catch(d){a.log(d)}})},setMicrophone:function(b,d){a.__queue(function(){a.__flash.setMicrophone(b,d)})},getMicrophone:function(){return a.initialized?
a.__flash.getMicrophone():null},getMicrophones:function(){return a.initialized?a.__flash.getMicrophones():[]},setUseEchoSuppression:function(b){a.__queue(function(){try{a.__flash.setUseEchoSupression(b)}catch(d){a.log(d)}})},setSilenceLevel:function(b,d){a.__queue(function(){try{a.__flash.setSilenceLevel(b,d)}catch(e){a.log(e)}})},showSettings:function(){a.__queue(function(){a.__flash.showSettings()})},isMicMuted:function(){try{return a.__flash.isMicMuted()}catch(b){if(!(b instanceof TypeError))throw b;
}},log:function(b,d,e){if(a.__debug&&window.console&&(e=e||"log",console[e]("[MediaStream] "+b),"undefined"!=typeof d))console[e](d)}};n={__onFlashInitialized:function(){a.__flash=document.getElementById(a.__flash.id);setTimeout(function(){a.initialized=!0;a.__flash.setDebug(a.__debug);/Mac OS X.*Chrome\/2[34]/.test(navigator.userAgent)?a.setMicrophone(-1,!1):a.setMicrophone(-1,!0);var b=a.getMicrophone();a.log(b?"Using "+b:"No mics available");a.setMicrophoneGain(75);for(b=0;b<a.__tasks.length;b++)a.__tasks[b].call()},
0)},__onMediaStreamEvent:function(){setTimeout(function(){for(var b=a.__flash.dequeueEvents(),d=0;d<b.length;d++)try{a.log("Received event: "+b[d].type),a.__instances[b[d].mediaStreamId].__handleEvent(b[d])}catch(e){a.log("Error while processing "+b[d].type+": "+e.message,e,"error")}},0)},__onLog:function(b){"error"==b.level?a.log(b.message,void 0,"error"):a.log(b.message)},__onUserResponse:function(b){for(var d=0;d<a.__responseCB.length;d++)a.__responseCB[d](b);a.__responseCB=[]}};for(var b in f)a[b]=
f[b];for(b in n)a[b]=n[b];a.__nextId=0;a.__flash=null;a.__instances={};a.__tasks=[];a.__responseCB=[];a.__debug=!1;a.initialized=!1;a.AMF0=0;a.AMF3=3;h.MediaStream=a},{"../../lib/twilio/util":21,"../swfobject":37}],36:[function(f,n,h){function a(b){if(!(this instanceof a))return new a(b);this.id=a.nextId++;a.items[this.id]=this;this.create();return this}var d=f("../swfobject").swfobject,g={create:function(){this.audio=document.createElement("audio");this.playing=!1},buffer:function(){},play:function(a,
b){if(!(this.playing||0>=b)){if(this.audio.currentTime!==a)try{if(this.audio.currentTime=a,this.audio.currentTime!==a)throw Error();}catch(c){var d=this.audio.src;this.audio.src="";this.audio.src=d}this.playing=!0;this.audio.play();var e=this;this.audio.addEventListener("ended",function x(){e.audio.removeEventListener("ended",x,!1);e.playing?(e.playing=!1,e.play(a,b-1)):e.playing=!1},!1)}},load:function(a){this.audio.src=a},stop:function(){this.playing=!1},destroy:function(){this.audio.src="";delete this.audio}},
e={create:function(){var b=this.id;a.queue(function(){a.flash.__create(b)})},buffer:function(b){var c=this.id;a.queue(function(){a.flash.__buffer(c,b)})},play:function(b,c){b=b||0;c=c||0;var d=this.id;a.queue(function(){a.flash.__play(d,b,c)})},load:function(b){var c=this.id;a.queue(function(){a.flash.__load(c,b)})},stop:function(){var b=this.id;a.queue(function(){a.flash.__stop(b)})},destroy:function(){var b=this.id;a.queue(function(){a.flash.__destroy(b);delete a.items[b]})}},b={create:function(){},
buffer:function(a){},play:function(a,b){},load:function(a){},stop:function(){},destroy:function(){}};if("undefined"===typeof window)for(var c in b)a.prototype[c]=b[c];var k={initializeFlash:function(b){b=b||{};b.swfLocation=b.swfLocation||"SoundMain.swf";b.domId=b.domId||"__soundFlash__";if(!a.flash)if(document.body){var c=document.createElement("div");c.id=b.domId;document.body.appendChild(c);a.flash=c;d.embedSWF(b.swfLocation,b.domId,"1","1","10.0.0",null,{namespace:"Twilio.Sound"},{hasPriority:!0,
allowScriptAccess:"always"},null,function(b){a.log("Embed "+(b.success?"succeeded":"failed"))})}else try{window.addEventListener("load",function(){a.initializeFlash(b)},!1)}catch(e){window.attachEvent("onload",function(){a.initializeFlash(b)})}},log:function(b,c,d){if(a.debug&&window.console&&(d=d||"log",console[d]("[Sound] "+b),"undefined"!=typeof c))console[d](c)},queue:function(b){a.initialized?b():a.tasks.push(b)}},u={__onFlashInitialized:function(){a.initialized=!0;a.flash=document.getElementById(a.flash.id);
setTimeout(function(){a.flash.__setDebug(a.debug);a.log("Initialized and ready");for(var b=0;b<a.tasks.length;b++)a.tasks[b]()},0)},__onLog:function(b){a.log(b)}};a.nextId=0;a.debug=!1;a.tasks=[];a.items={};a.initialize=function(c){if(!c.forceFlash&&document.createElement("audio"))a.prototype=g;else if(d.hasFlashPlayerVersion("10.0.0")){a.prototype=e;for(var f in k)a[f]=k[f];for(f in u)a[f]=u[f];a.initializeFlash(c)}else a.prototype=b,"undefined"!=typeof console&&(console.error||console.log||function(){})("WARNING: Audio sounds disabled. HTML5 audio support or Flash Player >= 10.0.0 is required")};
h.Sound=a},{"../swfobject":37}],37:[function(f,n,h){if("undefined"!==typeof window){var a=function(){function d(){if(!J){try{var a=m.getElementsByTagName("body")[0].appendChild(m.createElement("span"));a.parentNode.removeChild(a)}catch(b){return}J=!0;for(var a=L.length,c=0;c<a;c++)L[c]()}}function f(a){J?a():L[L.length]=a}function e(a){if("undefined"!=typeof q.addEventListener)q.addEventListener("load",a,!1);else if("undefined"!=typeof m.addEventListener)m.addEventListener("load",a,!1);else if("undefined"!=
typeof q.attachEvent)x(q,"onload",a);else if("function"==typeof q.onload){var b=q.onload;q.onload=function(){b();a()}}else q.onload=a}function b(){var a=m.getElementsByTagName("body")[0],b=m.createElement("object");b.setAttribute("type","application/x-shockwave-flash");var d=a.appendChild(b);if(d){var e=0;(function(){if("undefined"!=typeof d.GetVariable){var f=d.GetVariable("$version");f&&(f=f.split(" ")[1].split(","),w.pv=[parseInt(f[0],10),parseInt(f[1],10),parseInt(f[2],10)])}else if(10>e){e++;
setTimeout(arguments.callee,10);return}a.removeChild(b);d=null;c()})()}else c()}function c(){var a=F.length;if(0<a)for(var b=0;b<a;b++){var c=F[b].id,d=F[b].callbackFn,e={success:!1,id:c};if(0<w.pv[0]){var f=r(c);if(f)if(!D(F[b].swfVersion)||w.wk&&312>w.wk)if(F[b].expressInstall&&n()){e={};e.data=F[b].expressInstall;e.width=f.getAttribute("width")||"0";e.height=f.getAttribute("height")||"0";f.getAttribute("class")&&(e.styleclass=f.getAttribute("class"));f.getAttribute("align")&&(e.align=f.getAttribute("align"));
for(var g={},f=f.getElementsByTagName("param"),m=f.length,q=0;q<m;q++)"movie"!=f[q].getAttribute("name").toLowerCase()&&(g[f[q].getAttribute("name")]=f[q].getAttribute("value"));l(e,g,c,d)}else t(f),d&&d(e);else p(c,!0),d&&(e.success=!0,e.ref=h(c),d(e))}else p(c,!0),d&&((c=h(c))&&"undefined"!=typeof c.SetVariable&&(e.success=!0,e.ref=c),d(e))}}function h(a){var b=null;(a=r(a))&&"OBJECT"==a.nodeName&&("undefined"!=typeof a.SetVariable?b=a:(a=a.getElementsByTagName("object")[0])&&(b=a));return b}function n(){return!N&&
D("6.0.65")&&(w.win||w.mac)&&!(w.wk&&312>w.wk)}function l(a,b,c,d){N=!0;O=d||null;Q={success:!1,id:c};var e=r(c);if(e){"OBJECT"==e.nodeName?(K=C(e),M=null):(K=e,M=c);a.id="SWFObjectExprInst";if("undefined"==typeof a.width||!/%$/.test(a.width)&&310>parseInt(a.width,10))a.width="310";if("undefined"==typeof a.height||!/%$/.test(a.height)&&137>parseInt(a.height,10))a.height="137";m.title=m.title.slice(0,47)+" - Flash Player Installation";d=w.ie&&w.win?"ActiveX":"PlugIn";d="MMredirectURL="+q.location.toString().replace(/&/g,
"%26")+"&MMplayerType="+d+"&MMdoctitle="+m.title;b.flashvars="undefined"!=typeof b.flashvars?b.flashvars+("&"+d):d;w.ie&&w.win&&4!=e.readyState&&(d=m.createElement("div"),c+="SWFObjectNew",d.setAttribute("id",c),e.parentNode.insertBefore(d,e),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}());y(a,b,c)}}function t(a){if(w.ie&&w.win&&4!=a.readyState){var b=m.createElement("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(C(a),
b);a.style.display="none";(function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)})()}else a.parentNode.replaceChild(C(a),a)}function C(a){var b=m.createElement("div");if(w.win&&w.ie)b.innerHTML=a.innerHTML;else if(a=a.getElementsByTagName("object")[0])if(a=a.childNodes)for(var c=a.length,d=0;d<c;d++)1==a[d].nodeType&&"PARAM"==a[d].nodeName||8==a[d].nodeType||b.appendChild(a[d].cloneNode(!0));return b}function y(a,b,c){var d,e=r(c);if(w.wk&&312>w.wk)return d;if(e)if("undefined"==
typeof a.id&&(a.id=c),w.ie&&w.win){var f="",g;for(g in a)a[g]!=Object.prototype[g]&&("data"==g.toLowerCase()?b.movie=a[g]:"styleclass"==g.toLowerCase()?f+=' class="'+a[g]+'"':"classid"!=g.toLowerCase()&&(f+=" "+g+'="'+a[g]+'"'));g="";for(var h in b)b[h]!=Object.prototype[h]&&(g+='<param name="'+h+'" value="'+b[h]+'" />');e.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+f+">"+g+"</object>";H[H.length]=a.id;d=r(a.id)}else{h=m.createElement("object");h.setAttribute("type","application/x-shockwave-flash");
for(var k in a)a[k]!=Object.prototype[k]&&("styleclass"==k.toLowerCase()?h.setAttribute("class",a[k]):"classid"!=k.toLowerCase()&&h.setAttribute(k,a[k]));for(f in b)b[f]!=Object.prototype[f]&&"movie"!=f.toLowerCase()&&(a=h,g=f,k=b[f],c=m.createElement("param"),c.setAttribute("name",g),c.setAttribute("value",k),a.appendChild(c));e.parentNode.replaceChild(h,e);d=h}return d}function v(a){var b=r(a);b&&"OBJECT"==b.nodeName&&(w.ie&&w.win?(b.style.display="none",function(){if(4==b.readyState){var c=r(a);
if(c){for(var d in c)"function"==typeof c[d]&&(c[d]=null);c.parentNode.removeChild(c)}}else setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function r(a){var b=null;try{b=m.getElementById(a)}catch(c){}return b}function x(a,b,c){a.attachEvent(b,c);G[G.length]=[a,b,c]}function D(a){var b=w.pv;a=a.split(".");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10)||0;a[2]=parseInt(a[2],10)||0;return b[0]>a[0]||b[0]==a[0]&&b[1]>a[1]||b[0]==a[0]&&b[1]==a[1]&&b[2]>=a[2]?!0:!1}function B(a,b,c,d){if(!w.ie||
!w.mac){var e=m.getElementsByTagName("head")[0];e&&(c=c&&"string"==typeof c?c:"screen",d&&(P=I=null),I&&P==c||(d=m.createElement("style"),d.setAttribute("type","text/css"),d.setAttribute("media",c),I=e.appendChild(d),w.ie&&w.win&&"undefined"!=typeof m.styleSheets&&0<m.styleSheets.length&&(I=m.styleSheets[m.styleSheets.length-1]),P=c),w.ie&&w.win?I&&"object"==typeof I.addRule&&I.addRule(a,b):I&&"undefined"!=typeof m.createTextNode&&I.appendChild(m.createTextNode(a+" {"+b+"}")))}}function p(a,b){if(R){var c=
b?"visible":"hidden";J&&r(a)?r(a).style.visibility=c:B("#"+a,"visibility:"+c)}}function E(a){return null!=/[\\\"<>\.;]/.exec(a)&&"undefined"!=typeof encodeURIComponent?encodeURIComponent(a):a}var q=window,m=document,z=navigator,A=!1,L=[function(){A?b():c()}],F=[],H=[],G=[],K,M,O,Q,J=!1,N=!1,I,P,R=!0,w=function(){var a="undefined"!=typeof m.getElementById&&"undefined"!=typeof m.getElementsByTagName&&"undefined"!=typeof m.createElement,b=z.userAgent.toLowerCase(),c=z.platform.toLowerCase(),d=c?/win/.test(c):
/win/.test(b),c=c?/mac/.test(c):/mac/.test(b),b=/webkit/.test(b)?parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,e=!+"\v1",f=[0,0,0],g=null;if("undefined"!=typeof z.plugins&&"object"==typeof z.plugins["Shockwave Flash"])!(g=z.plugins["Shockwave Flash"].description)||"undefined"!=typeof z.mimeTypes&&z.mimeTypes["application/x-shockwave-flash"]&&!z.mimeTypes["application/x-shockwave-flash"].enabledPlugin||(A=!0,e=!1,g=g.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),f[0]=parseInt(g.replace(/^(.*)\..*$/,
"$1"),10),f[1]=parseInt(g.replace(/^.*\.(.*)\s.*$/,"$1"),10),f[2]=/[a-zA-Z]/.test(g)?parseInt(g.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if("undefined"!=typeof q.ActiveXObject)try{var h=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");h&&(g=h.GetVariable("$version"))&&(e=!0,g=g.split(" ")[1].split(","),f=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)])}catch(k){}return{w3:a,pv:f,wk:b,ie:e,win:d,mac:c}}();(function(){w.w3&&(("undefined"!=typeof m.readyState&&"complete"==m.readyState||
"undefined"==typeof m.readyState&&(m.getElementsByTagName("body")[0]||m.body))&&d(),J||("undefined"!=typeof m.addEventListener&&m.addEventListener("DOMContentLoaded",d,!1),w.ie&&w.win&&(m.attachEvent("onreadystatechange",function(){"complete"==m.readyState&&(m.detachEvent("onreadystatechange",arguments.callee),d())}),q==top&&function(){if(!J){try{m.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}d()}}()),w.wk&&function(){J||(/loaded|complete/.test(m.readyState)?d():
setTimeout(arguments.callee,0))}(),e(d)))})();(function(){w.ie&&w.win&&window.attachEvent("onunload",function(){for(var b=G.length,c=0;c<b;c++)G[c][0].detachEvent(G[c][1],G[c][2]);b=H.length;for(c=0;c<b;c++)v(H[c]);for(var d in w)w[d]=null;w=null;for(var e in a)a[e]=null;a=null})})();return{registerObject:function(a,b,c,d){if(w.w3&&a&&b){var e={};e.id=a;e.swfVersion=b;e.expressInstall=c;e.callbackFn=d;F[F.length]=e;p(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(w.w3)return h(a)},
embedSWF:function(a,b,c,d,e,h,k,m,q,t){var r={success:!1,id:b};w.w3&&!(w.wk&&312>w.wk)&&a&&b&&c&&d&&e?(p(b,!1),f(function(){c+="";d+="";var f={};if(q&&"object"===typeof q)for(var g in q)f[g]=q[g];f.data=a;f.width=c;f.height=d;g={};if(m&&"object"===typeof m)for(var v in m)g[v]=m[v];if(k&&"object"===typeof k)for(var w in k)g.flashvars="undefined"!=typeof g.flashvars?g.flashvars+("&"+w+"="+k[w]):w+"="+k[w];if(D(e))v=y(f,g,b),f.id==b&&p(b,!0),r.success=!0,r.ref=v;else{if(h&&n()){f.data=h;l(f,g,b,t);return}p(b,
!0)}t&&t(r)})):t&&t(r)},switchOffAutoHideShow:function(){R=!1},ua:w,getFlashPlayerVersion:function(){return{major:w.pv[0],minor:w.pv[1],release:w.pv[2]}},hasFlashPlayerVersion:D,createSWF:function(a,b,c){if(w.w3)return y(a,b,c)},showExpressInstall:function(a,b,c,d){w.w3&&n()&&l(a,b,c,d)},removeSWF:function(a){w.w3&&v(a)},createCSS:function(a,b,c,d){w.w3&&B(a,b,c,d)},addDomLoadEvent:f,addLoadEvent:e,getQueryParamValue:function(a){var b=m.location.search||m.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);
if(null==a)return E(b);for(var b=b.split("&"),c=0;c<b.length;c++)if(b[c].substring(0,b[c].indexOf("="))==a)return E(b[c].substring(b[c].indexOf("=")+1))}return""},expressInstallCallback:function(){if(N){var a=r("SWFObjectExprInst");a&&K&&(a.parentNode.replaceChild(K,a),M&&(p(M,!0),w.ie&&w.win&&(K.style.display="block")),O&&O(Q));N=!1}}}}();window.swfobject=a}else a={getFlashPlayerVersion:function(){}};h.swfobject=a},{}],38:[function(f,n,h){(function(a){var d=f("../swfobject").swfobject;if("undefined"!==
typeof a&&"node"===a.title)var g=eval("require('ws')");h.WebSocket=function(){if(g)return g;if(window.WebSocket)return window.WebSocket;var a=window.console;a&&a.log&&a.error||(a={log:function(){},error:function(){}});if(d.hasFlashPlayerVersion("10.0.0"))return"file:"==location.protocol&&a.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(a,c,d,e,f){var g=this;g.__id=WebSocket.__nextId++;
WebSocket.__instances[g.__id]=g;g.readyState=WebSocket.CONNECTING;g.bufferedAmount=0;g.__events={};setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(g.__id,a,c,d||null,e||0,f||null)})},0)},WebSocket.prototype.send=function(a){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";a=WebSocket.__flash.send(this.__id,encodeURIComponent(a));if(0>a)return!0;this.bufferedAmount+=a;return!1},WebSocket.prototype.close=
function(){this.readyState!=WebSocket.CLOSED&&this.readyState!=WebSocket.CLOSING&&(this.readyState=WebSocket.CLOSING,WebSocket.__addTask(function(){WebSocket.__flash.close(this.__id)}))},WebSocket.prototype.addEventListener=function(a,c,d){a in this.__events||(this.__events[a]=[]);this.__events[a].push(c)},WebSocket.prototype.removeEventListener=function(a,c,d){if(a in this.__events)for(a=this.__events[a],d=a.length-1;0<=d;--d)if(a[d]===c){a.splice(d,1);break}},WebSocket.prototype.dispatchEvent=function(a){for(var c=
this.__events[a.type]||[],d=0;d<c.length;++d)c[d](a);(c=this["on"+a.type])&&c(a)},WebSocket.prototype.__handleEvent=function(a){"readyState"in a&&(this.readyState=a.readyState);if("open"==a.type||"error"==a.type)a=this.__createSimpleEvent(a.type);else if("close"==a.type)a=this.__createSimpleEvent("close");else if("message"==a.type)a=decodeURIComponent(a.message),a=this.__createMessageEvent("message",a);else throw"unknown event type: "+a.type;this.dispatchEvent(a)},WebSocket.prototype.__createSimpleEvent=
function(a){if(document.createEvent&&window.Event){var c=document.createEvent("Event");c.initEvent(a,!1,!1);return c}return{type:a,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(a,c){if(document.createEvent&&window.MessageEvent&&!window.opera){var d=document.createEvent("MessageEvent");d.initMessageEvent("message",!1,!1,c,null,null,window,null);return d}return{type:a,data:c,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=
3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(a){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(a)})},WebSocket.__initialize=function(){if(!WebSocket.__flash)if(document.body)if(WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),window.WEB_SOCKET_SWF_LOCATION){var b=document.createElement("div");b.id="webSocketContainer";b.style.position="absolute";WebSocket.__isFlashLite()?
(b.style.left="0px",b.style.top="0px"):(b.style.left="-100px",b.style.top="-100px");var c=document.createElement("div");c.id="webSocketFlash";b.appendChild(c);document.body.appendChild(b);d.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(b){b.success||a.error("[WebSocket] swfobject.embedSWF failed")})}else a.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");else window.addEventListener?
window.addEventListener("load",WebSocket.__initialize,!1):window.attachEvent("onload",WebSocket.__initialize)},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash");WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var a=0;a<WebSocket.__tasks.length;++a)WebSocket.__tasks[a]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){setTimeout(function(){try{for(var b=WebSocket.__flash.receiveEvents(),
c=0;c<b.length;++c)WebSocket.__instances[b[c].webSocketId].__handleEvent(b[c])}catch(d){a.error(d)}},0);return!0},WebSocket.__log=function(b){a.log(decodeURIComponent(b))},WebSocket.__error=function(b){a.error(decodeURIComponent(b))},WebSocket.__addTask=function(a){WebSocket.__flash?a():WebSocket.__tasks.push(a)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var a=window.navigator.mimeTypes["application/x-shockwave-flash"];return a&&a.enabledPlugin&&
a.enabledPlugin.filename?a.enabledPlugin.filename.match(/flashlite/i)?!0:!1:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||WebSocket.__initialize(),WebSocket;a.error("Flash Player >= 10.0.0 is required.")}()}).call(this,f("_process"))},{"../swfobject":37,_process:29}]},{},[1]);